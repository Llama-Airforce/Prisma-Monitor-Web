import{i as hr,g as fr,d as ur,a as He,s as cr,r as Ze,b as Fe,c as lr,m as je}from"./mobile-98aae706.js";import{bJ as dr,bK as mr,bP as Je,cp as pr,cq as Ue}from"./vendor-d50ff160.js";import{b as jt}from"./index-4eee43ae.js";import{p as gr,s as ue,a as ce,d as le,c as Ct}from"./index-dbe394b9.js";import"./index-3aa13386.js";const vr=["session_request","session_update","exchange_key","connect","disconnect","display_uri","modal_closed","transport_open","transport_close","transport_error"],De=["eth_sendTransaction","eth_signTransaction","eth_sign","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v2","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"];var de={exports:{}};de.exports;(function(a){(function(i,c){function g(m,t){if(!m)throw new Error(t||"Assertion failed")}function b(m,t){m.super_=t;var r=function(){};r.prototype=t.prototype,m.prototype=new r,m.prototype.constructor=m}function d(m,t,r){if(d.isBN(m))return m;this.negative=0,this.words=null,this.length=0,this.red=null,m!==null&&((t==="le"||t==="be")&&(r=t,t=10),this._init(m||0,t||10,r||"be"))}typeof i=="object"?i.exports=d:c.BN=d,d.BN=d,d.wordSize=26;var A;try{A=dr.Buffer}catch{}d.isBN=function(t){return t instanceof d?!0:t!==null&&typeof t=="object"&&t.constructor.wordSize===d.wordSize&&Array.isArray(t.words)},d.max=function(t,r){return t.cmp(r)>0?t:r},d.min=function(t,r){return t.cmp(r)<0?t:r},d.prototype._init=function(t,r,n){if(typeof t=="number")return this._initNumber(t,r,n);if(typeof t=="object")return this._initArray(t,r,n);r==="hex"&&(r=16),g(r===(r|0)&&r>=2&&r<=36),t=t.toString().replace(/\s+/g,"");var o=0;t[0]==="-"&&o++,r===16?this._parseHex(t,o):this._parseBase(t,r,o),t[0]==="-"&&(this.negative=1),this.strip(),n==="le"&&this._initArray(this.toArray(),r,n)},d.prototype._initNumber=function(t,r,n){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[t&67108863],this.length=1):t<4503599627370496?(this.words=[t&67108863,t/67108864&67108863],this.length=2):(g(t<9007199254740992),this.words=[t&67108863,t/67108864&67108863,1],this.length=3),n==="le"&&this._initArray(this.toArray(),r,n)},d.prototype._initArray=function(t,r,n){if(g(typeof t.length=="number"),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var o=0;o<this.length;o++)this.words[o]=0;var u,p,M=0;if(n==="be")for(o=t.length-1,u=0;o>=0;o-=3)p=t[o]|t[o-1]<<8|t[o-2]<<16,this.words[u]|=p<<M&67108863,this.words[u+1]=p>>>26-M&67108863,M+=24,M>=26&&(M-=26,u++);else if(n==="le")for(o=0,u=0;o<t.length;o+=3)p=t[o]|t[o+1]<<8|t[o+2]<<16,this.words[u]|=p<<M&67108863,this.words[u+1]=p>>>26-M&67108863,M+=24,M>=26&&(M-=26,u++);return this.strip()};function j(m,t,r){for(var n=0,o=Math.min(m.length,r),u=t;u<o;u++){var p=m.charCodeAt(u)-48;n<<=4,p>=49&&p<=54?n|=p-49+10:p>=17&&p<=22?n|=p-17+10:n|=p&15}return n}d.prototype._parseHex=function(t,r){this.length=Math.ceil((t.length-r)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var o,u,p=0;for(n=t.length-6,o=0;n>=r;n-=6)u=j(t,n,n+6),this.words[o]|=u<<p&67108863,this.words[o+1]|=u>>>26-p&4194303,p+=24,p>=26&&(p-=26,o++);n+6!==r&&(u=j(t,r,n+6),this.words[o]|=u<<p&67108863,this.words[o+1]|=u>>>26-p&4194303),this.strip()};function S(m,t,r,n){for(var o=0,u=Math.min(m.length,r),p=t;p<u;p++){var M=m.charCodeAt(p)-48;o*=n,M>=49?o+=M-49+10:M>=17?o+=M-17+10:o+=M}return o}d.prototype._parseBase=function(t,r,n){this.words=[0],this.length=1;for(var o=0,u=1;u<=67108863;u*=r)o++;o--,u=u/r|0;for(var p=t.length-n,M=p%o,h=Math.min(p,p-M)+n,e=0,f=n;f<h;f+=o)e=S(t,f,f+o,r),this.imuln(u),this.words[0]+e<67108864?this.words[0]+=e:this._iaddn(e);if(M!==0){var x=1;for(e=S(t,f,t.length,r),f=0;f<M;f++)x*=r;this.imuln(x),this.words[0]+e<67108864?this.words[0]+=e:this._iaddn(e)}},d.prototype.copy=function(t){t.words=new Array(this.length);for(var r=0;r<this.length;r++)t.words[r]=this.words[r];t.length=this.length,t.negative=this.negative,t.red=this.red},d.prototype.clone=function(){var t=new d(null);return this.copy(t),t},d.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},d.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},d.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},d.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var T=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],_t=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],Mt=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];d.prototype.toString=function(t,r){t=t||10,r=r|0||1;var n;if(t===16||t==="hex"){n="";for(var o=0,u=0,p=0;p<this.length;p++){var M=this.words[p],h=((M<<o|u)&16777215).toString(16);u=M>>>24-o&16777215,u!==0||p!==this.length-1?n=T[6-h.length]+h+n:n=h+n,o+=2,o>=26&&(o-=26,p--)}for(u!==0&&(n=u.toString(16)+n);n.length%r!==0;)n="0"+n;return this.negative!==0&&(n="-"+n),n}if(t===(t|0)&&t>=2&&t<=36){var e=_t[t],f=Mt[t];n="";var x=this.clone();for(x.negative=0;!x.isZero();){var R=x.modn(f).toString(t);x=x.idivn(f),x.isZero()?n=R+n:n=T[e-R.length]+R+n}for(this.isZero()&&(n="0"+n);n.length%r!==0;)n="0"+n;return this.negative!==0&&(n="-"+n),n}g(!1,"Base should be between 2 and 36")},d.prototype.toNumber=function(){var t=this.words[0];return this.length===2?t+=this.words[1]*67108864:this.length===3&&this.words[2]===1?t+=4503599627370496+this.words[1]*67108864:this.length>2&&g(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-t:t},d.prototype.toJSON=function(){return this.toString(16)},d.prototype.toBuffer=function(t,r){return g(typeof A<"u"),this.toArrayLike(A,t,r)},d.prototype.toArray=function(t,r){return this.toArrayLike(Array,t,r)},d.prototype.toArrayLike=function(t,r,n){var o=this.byteLength(),u=n||Math.max(1,o);g(o<=u,"byte array longer than desired length"),g(u>0,"Requested array length <= 0"),this.strip();var p=r==="le",M=new t(u),h,e,f=this.clone();if(p){for(e=0;!f.isZero();e++)h=f.andln(255),f.iushrn(8),M[e]=h;for(;e<u;e++)M[e]=0}else{for(e=0;e<u-o;e++)M[e]=0;for(e=0;!f.isZero();e++)h=f.andln(255),f.iushrn(8),M[u-e-1]=h}return M},Math.clz32?d.prototype._countBits=function(t){return 32-Math.clz32(t)}:d.prototype._countBits=function(t){var r=t,n=0;return r>=4096&&(n+=13,r>>>=13),r>=64&&(n+=7,r>>>=7),r>=8&&(n+=4,r>>>=4),r>=2&&(n+=2,r>>>=2),n+r},d.prototype._zeroBits=function(t){if(t===0)return 26;var r=t,n=0;return r&8191||(n+=13,r>>>=13),r&127||(n+=7,r>>>=7),r&15||(n+=4,r>>>=4),r&3||(n+=2,r>>>=2),r&1||n++,n},d.prototype.bitLength=function(){var t=this.words[this.length-1],r=this._countBits(t);return(this.length-1)*26+r};function wt(m){for(var t=new Array(m.bitLength()),r=0;r<t.length;r++){var n=r/26|0,o=r%26;t[r]=(m.words[n]&1<<o)>>>o}return t}d.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,r=0;r<this.length;r++){var n=this._zeroBits(this.words[r]);if(t+=n,n!==26)break}return t},d.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},d.prototype.toTwos=function(t){return this.negative!==0?this.abs().inotn(t).iaddn(1):this.clone()},d.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},d.prototype.isNeg=function(){return this.negative!==0},d.prototype.neg=function(){return this.clone().ineg()},d.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},d.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]|t.words[r];return this.strip()},d.prototype.ior=function(t){return g((this.negative|t.negative)===0),this.iuor(t)},d.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},d.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},d.prototype.iuand=function(t){var r;this.length>t.length?r=t:r=this;for(var n=0;n<r.length;n++)this.words[n]=this.words[n]&t.words[n];return this.length=r.length,this.strip()},d.prototype.iand=function(t){return g((this.negative|t.negative)===0),this.iuand(t)},d.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},d.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},d.prototype.iuxor=function(t){var r,n;this.length>t.length?(r=this,n=t):(r=t,n=this);for(var o=0;o<n.length;o++)this.words[o]=r.words[o]^n.words[o];if(this!==r)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=r.length,this.strip()},d.prototype.ixor=function(t){return g((this.negative|t.negative)===0),this.iuxor(t)},d.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},d.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},d.prototype.inotn=function(t){g(typeof t=="number"&&t>=0);var r=Math.ceil(t/26)|0,n=t%26;this._expand(r),n>0&&r--;for(var o=0;o<r;o++)this.words[o]=~this.words[o]&67108863;return n>0&&(this.words[o]=~this.words[o]&67108863>>26-n),this.strip()},d.prototype.notn=function(t){return this.clone().inotn(t)},d.prototype.setn=function(t,r){g(typeof t=="number"&&t>=0);var n=t/26|0,o=t%26;return this._expand(n+1),r?this.words[n]=this.words[n]|1<<o:this.words[n]=this.words[n]&~(1<<o),this.strip()},d.prototype.iadd=function(t){var r;if(this.negative!==0&&t.negative===0)return this.negative=0,r=this.isub(t),this.negative^=1,this._normSign();if(this.negative===0&&t.negative!==0)return t.negative=0,r=this.isub(t),t.negative=1,r._normSign();var n,o;this.length>t.length?(n=this,o=t):(n=t,o=this);for(var u=0,p=0;p<o.length;p++)r=(n.words[p]|0)+(o.words[p]|0)+u,this.words[p]=r&67108863,u=r>>>26;for(;u!==0&&p<n.length;p++)r=(n.words[p]|0)+u,this.words[p]=r&67108863,u=r>>>26;if(this.length=n.length,u!==0)this.words[this.length]=u,this.length++;else if(n!==this)for(;p<n.length;p++)this.words[p]=n.words[p];return this},d.prototype.add=function(t){var r;return t.negative!==0&&this.negative===0?(t.negative=0,r=this.sub(t),t.negative^=1,r):t.negative===0&&this.negative!==0?(this.negative=0,r=t.sub(this),this.negative=1,r):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},d.prototype.isub=function(t){if(t.negative!==0){t.negative=0;var r=this.iadd(t);return t.negative=1,r._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var n=this.cmp(t);if(n===0)return this.negative=0,this.length=1,this.words[0]=0,this;var o,u;n>0?(o=this,u=t):(o=t,u=this);for(var p=0,M=0;M<u.length;M++)r=(o.words[M]|0)-(u.words[M]|0)+p,p=r>>26,this.words[M]=r&67108863;for(;p!==0&&M<o.length;M++)r=(o.words[M]|0)+p,p=r>>26,this.words[M]=r&67108863;if(p===0&&M<o.length&&o!==this)for(;M<o.length;M++)this.words[M]=o.words[M];return this.length=Math.max(this.length,M),o!==this&&(this.negative=1),this.strip()},d.prototype.sub=function(t){return this.clone().isub(t)};function yt(m,t,r){r.negative=t.negative^m.negative;var n=m.length+t.length|0;r.length=n,n=n-1|0;var o=m.words[0]|0,u=t.words[0]|0,p=o*u,M=p&67108863,h=p/67108864|0;r.words[0]=M;for(var e=1;e<n;e++){for(var f=h>>>26,x=h&67108863,R=Math.min(e,t.length-1),k=Math.max(0,e-m.length+1);k<=R;k++){var O=e-k|0;o=m.words[O]|0,u=t.words[k]|0,p=o*u+x,f+=p/67108864|0,x=p&67108863}r.words[e]=x|0,h=f|0}return h!==0?r.words[e]=h|0:r.length--,r.strip()}var bt=function(t,r,n){var o=t.words,u=r.words,p=n.words,M=0,h,e,f,x=o[0]|0,R=x&8191,k=x>>>13,O=o[1]|0,q=O&8191,N=O>>>13,xt=o[2]|0,C=xt&8191,F=xt>>>13,ye=o[3]|0,B=ye&8191,L=ye>>>13,Me=o[4]|0,$=Me&8191,P=Me>>>13,we=o[5]|0,H=we&8191,Z=we>>>13,_e=o[6]|0,J=_e&8191,D=_e>>>13,be=o[7]|0,K=be&8191,Q=be>>>13,Se=o[8]|0,W=Se&8191,z=Se>>>13,xe=o[9]|0,G=xe&8191,V=xe>>>13,Ie=u[0]|0,Y=Ie&8191,X=Ie>>>13,Re=u[1]|0,tt=Re&8191,et=Re>>>13,ke=u[2]|0,rt=ke&8191,it=ke>>>13,Oe=u[3]|0,nt=Oe&8191,st=Oe>>>13,Ee=u[4]|0,ot=Ee&8191,at=Ee>>>13,Ae=u[5]|0,ht=Ae&8191,ft=Ae>>>13,qe=u[6]|0,ut=qe&8191,ct=qe>>>13,Te=u[7]|0,lt=Te&8191,dt=Te>>>13,Ne=u[8]|0,mt=Ne&8191,pt=Ne>>>13,Ce=u[9]|0,gt=Ce&8191,vt=Ce>>>13;n.negative=t.negative^r.negative,n.length=19,h=Math.imul(R,Y),e=Math.imul(R,X),e=e+Math.imul(k,Y)|0,f=Math.imul(k,X);var $t=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+($t>>>26)|0,$t&=67108863,h=Math.imul(q,Y),e=Math.imul(q,X),e=e+Math.imul(N,Y)|0,f=Math.imul(N,X),h=h+Math.imul(R,tt)|0,e=e+Math.imul(R,et)|0,e=e+Math.imul(k,tt)|0,f=f+Math.imul(k,et)|0;var Pt=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(Pt>>>26)|0,Pt&=67108863,h=Math.imul(C,Y),e=Math.imul(C,X),e=e+Math.imul(F,Y)|0,f=Math.imul(F,X),h=h+Math.imul(q,tt)|0,e=e+Math.imul(q,et)|0,e=e+Math.imul(N,tt)|0,f=f+Math.imul(N,et)|0,h=h+Math.imul(R,rt)|0,e=e+Math.imul(R,it)|0,e=e+Math.imul(k,rt)|0,f=f+Math.imul(k,it)|0;var Ht=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(Ht>>>26)|0,Ht&=67108863,h=Math.imul(B,Y),e=Math.imul(B,X),e=e+Math.imul(L,Y)|0,f=Math.imul(L,X),h=h+Math.imul(C,tt)|0,e=e+Math.imul(C,et)|0,e=e+Math.imul(F,tt)|0,f=f+Math.imul(F,et)|0,h=h+Math.imul(q,rt)|0,e=e+Math.imul(q,it)|0,e=e+Math.imul(N,rt)|0,f=f+Math.imul(N,it)|0,h=h+Math.imul(R,nt)|0,e=e+Math.imul(R,st)|0,e=e+Math.imul(k,nt)|0,f=f+Math.imul(k,st)|0;var Zt=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(Zt>>>26)|0,Zt&=67108863,h=Math.imul($,Y),e=Math.imul($,X),e=e+Math.imul(P,Y)|0,f=Math.imul(P,X),h=h+Math.imul(B,tt)|0,e=e+Math.imul(B,et)|0,e=e+Math.imul(L,tt)|0,f=f+Math.imul(L,et)|0,h=h+Math.imul(C,rt)|0,e=e+Math.imul(C,it)|0,e=e+Math.imul(F,rt)|0,f=f+Math.imul(F,it)|0,h=h+Math.imul(q,nt)|0,e=e+Math.imul(q,st)|0,e=e+Math.imul(N,nt)|0,f=f+Math.imul(N,st)|0,h=h+Math.imul(R,ot)|0,e=e+Math.imul(R,at)|0,e=e+Math.imul(k,ot)|0,f=f+Math.imul(k,at)|0;var Jt=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(Jt>>>26)|0,Jt&=67108863,h=Math.imul(H,Y),e=Math.imul(H,X),e=e+Math.imul(Z,Y)|0,f=Math.imul(Z,X),h=h+Math.imul($,tt)|0,e=e+Math.imul($,et)|0,e=e+Math.imul(P,tt)|0,f=f+Math.imul(P,et)|0,h=h+Math.imul(B,rt)|0,e=e+Math.imul(B,it)|0,e=e+Math.imul(L,rt)|0,f=f+Math.imul(L,it)|0,h=h+Math.imul(C,nt)|0,e=e+Math.imul(C,st)|0,e=e+Math.imul(F,nt)|0,f=f+Math.imul(F,st)|0,h=h+Math.imul(q,ot)|0,e=e+Math.imul(q,at)|0,e=e+Math.imul(N,ot)|0,f=f+Math.imul(N,at)|0,h=h+Math.imul(R,ht)|0,e=e+Math.imul(R,ft)|0,e=e+Math.imul(k,ht)|0,f=f+Math.imul(k,ft)|0;var Dt=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(Dt>>>26)|0,Dt&=67108863,h=Math.imul(J,Y),e=Math.imul(J,X),e=e+Math.imul(D,Y)|0,f=Math.imul(D,X),h=h+Math.imul(H,tt)|0,e=e+Math.imul(H,et)|0,e=e+Math.imul(Z,tt)|0,f=f+Math.imul(Z,et)|0,h=h+Math.imul($,rt)|0,e=e+Math.imul($,it)|0,e=e+Math.imul(P,rt)|0,f=f+Math.imul(P,it)|0,h=h+Math.imul(B,nt)|0,e=e+Math.imul(B,st)|0,e=e+Math.imul(L,nt)|0,f=f+Math.imul(L,st)|0,h=h+Math.imul(C,ot)|0,e=e+Math.imul(C,at)|0,e=e+Math.imul(F,ot)|0,f=f+Math.imul(F,at)|0,h=h+Math.imul(q,ht)|0,e=e+Math.imul(q,ft)|0,e=e+Math.imul(N,ht)|0,f=f+Math.imul(N,ft)|0,h=h+Math.imul(R,ut)|0,e=e+Math.imul(R,ct)|0,e=e+Math.imul(k,ut)|0,f=f+Math.imul(k,ct)|0;var Kt=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(Kt>>>26)|0,Kt&=67108863,h=Math.imul(K,Y),e=Math.imul(K,X),e=e+Math.imul(Q,Y)|0,f=Math.imul(Q,X),h=h+Math.imul(J,tt)|0,e=e+Math.imul(J,et)|0,e=e+Math.imul(D,tt)|0,f=f+Math.imul(D,et)|0,h=h+Math.imul(H,rt)|0,e=e+Math.imul(H,it)|0,e=e+Math.imul(Z,rt)|0,f=f+Math.imul(Z,it)|0,h=h+Math.imul($,nt)|0,e=e+Math.imul($,st)|0,e=e+Math.imul(P,nt)|0,f=f+Math.imul(P,st)|0,h=h+Math.imul(B,ot)|0,e=e+Math.imul(B,at)|0,e=e+Math.imul(L,ot)|0,f=f+Math.imul(L,at)|0,h=h+Math.imul(C,ht)|0,e=e+Math.imul(C,ft)|0,e=e+Math.imul(F,ht)|0,f=f+Math.imul(F,ft)|0,h=h+Math.imul(q,ut)|0,e=e+Math.imul(q,ct)|0,e=e+Math.imul(N,ut)|0,f=f+Math.imul(N,ct)|0,h=h+Math.imul(R,lt)|0,e=e+Math.imul(R,dt)|0,e=e+Math.imul(k,lt)|0,f=f+Math.imul(k,dt)|0;var Qt=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(Qt>>>26)|0,Qt&=67108863,h=Math.imul(W,Y),e=Math.imul(W,X),e=e+Math.imul(z,Y)|0,f=Math.imul(z,X),h=h+Math.imul(K,tt)|0,e=e+Math.imul(K,et)|0,e=e+Math.imul(Q,tt)|0,f=f+Math.imul(Q,et)|0,h=h+Math.imul(J,rt)|0,e=e+Math.imul(J,it)|0,e=e+Math.imul(D,rt)|0,f=f+Math.imul(D,it)|0,h=h+Math.imul(H,nt)|0,e=e+Math.imul(H,st)|0,e=e+Math.imul(Z,nt)|0,f=f+Math.imul(Z,st)|0,h=h+Math.imul($,ot)|0,e=e+Math.imul($,at)|0,e=e+Math.imul(P,ot)|0,f=f+Math.imul(P,at)|0,h=h+Math.imul(B,ht)|0,e=e+Math.imul(B,ft)|0,e=e+Math.imul(L,ht)|0,f=f+Math.imul(L,ft)|0,h=h+Math.imul(C,ut)|0,e=e+Math.imul(C,ct)|0,e=e+Math.imul(F,ut)|0,f=f+Math.imul(F,ct)|0,h=h+Math.imul(q,lt)|0,e=e+Math.imul(q,dt)|0,e=e+Math.imul(N,lt)|0,f=f+Math.imul(N,dt)|0,h=h+Math.imul(R,mt)|0,e=e+Math.imul(R,pt)|0,e=e+Math.imul(k,mt)|0,f=f+Math.imul(k,pt)|0;var Wt=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(Wt>>>26)|0,Wt&=67108863,h=Math.imul(G,Y),e=Math.imul(G,X),e=e+Math.imul(V,Y)|0,f=Math.imul(V,X),h=h+Math.imul(W,tt)|0,e=e+Math.imul(W,et)|0,e=e+Math.imul(z,tt)|0,f=f+Math.imul(z,et)|0,h=h+Math.imul(K,rt)|0,e=e+Math.imul(K,it)|0,e=e+Math.imul(Q,rt)|0,f=f+Math.imul(Q,it)|0,h=h+Math.imul(J,nt)|0,e=e+Math.imul(J,st)|0,e=e+Math.imul(D,nt)|0,f=f+Math.imul(D,st)|0,h=h+Math.imul(H,ot)|0,e=e+Math.imul(H,at)|0,e=e+Math.imul(Z,ot)|0,f=f+Math.imul(Z,at)|0,h=h+Math.imul($,ht)|0,e=e+Math.imul($,ft)|0,e=e+Math.imul(P,ht)|0,f=f+Math.imul(P,ft)|0,h=h+Math.imul(B,ut)|0,e=e+Math.imul(B,ct)|0,e=e+Math.imul(L,ut)|0,f=f+Math.imul(L,ct)|0,h=h+Math.imul(C,lt)|0,e=e+Math.imul(C,dt)|0,e=e+Math.imul(F,lt)|0,f=f+Math.imul(F,dt)|0,h=h+Math.imul(q,mt)|0,e=e+Math.imul(q,pt)|0,e=e+Math.imul(N,mt)|0,f=f+Math.imul(N,pt)|0,h=h+Math.imul(R,gt)|0,e=e+Math.imul(R,vt)|0,e=e+Math.imul(k,gt)|0,f=f+Math.imul(k,vt)|0;var zt=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(zt>>>26)|0,zt&=67108863,h=Math.imul(G,tt),e=Math.imul(G,et),e=e+Math.imul(V,tt)|0,f=Math.imul(V,et),h=h+Math.imul(W,rt)|0,e=e+Math.imul(W,it)|0,e=e+Math.imul(z,rt)|0,f=f+Math.imul(z,it)|0,h=h+Math.imul(K,nt)|0,e=e+Math.imul(K,st)|0,e=e+Math.imul(Q,nt)|0,f=f+Math.imul(Q,st)|0,h=h+Math.imul(J,ot)|0,e=e+Math.imul(J,at)|0,e=e+Math.imul(D,ot)|0,f=f+Math.imul(D,at)|0,h=h+Math.imul(H,ht)|0,e=e+Math.imul(H,ft)|0,e=e+Math.imul(Z,ht)|0,f=f+Math.imul(Z,ft)|0,h=h+Math.imul($,ut)|0,e=e+Math.imul($,ct)|0,e=e+Math.imul(P,ut)|0,f=f+Math.imul(P,ct)|0,h=h+Math.imul(B,lt)|0,e=e+Math.imul(B,dt)|0,e=e+Math.imul(L,lt)|0,f=f+Math.imul(L,dt)|0,h=h+Math.imul(C,mt)|0,e=e+Math.imul(C,pt)|0,e=e+Math.imul(F,mt)|0,f=f+Math.imul(F,pt)|0,h=h+Math.imul(q,gt)|0,e=e+Math.imul(q,vt)|0,e=e+Math.imul(N,gt)|0,f=f+Math.imul(N,vt)|0;var Gt=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(Gt>>>26)|0,Gt&=67108863,h=Math.imul(G,rt),e=Math.imul(G,it),e=e+Math.imul(V,rt)|0,f=Math.imul(V,it),h=h+Math.imul(W,nt)|0,e=e+Math.imul(W,st)|0,e=e+Math.imul(z,nt)|0,f=f+Math.imul(z,st)|0,h=h+Math.imul(K,ot)|0,e=e+Math.imul(K,at)|0,e=e+Math.imul(Q,ot)|0,f=f+Math.imul(Q,at)|0,h=h+Math.imul(J,ht)|0,e=e+Math.imul(J,ft)|0,e=e+Math.imul(D,ht)|0,f=f+Math.imul(D,ft)|0,h=h+Math.imul(H,ut)|0,e=e+Math.imul(H,ct)|0,e=e+Math.imul(Z,ut)|0,f=f+Math.imul(Z,ct)|0,h=h+Math.imul($,lt)|0,e=e+Math.imul($,dt)|0,e=e+Math.imul(P,lt)|0,f=f+Math.imul(P,dt)|0,h=h+Math.imul(B,mt)|0,e=e+Math.imul(B,pt)|0,e=e+Math.imul(L,mt)|0,f=f+Math.imul(L,pt)|0,h=h+Math.imul(C,gt)|0,e=e+Math.imul(C,vt)|0,e=e+Math.imul(F,gt)|0,f=f+Math.imul(F,vt)|0;var Vt=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(Vt>>>26)|0,Vt&=67108863,h=Math.imul(G,nt),e=Math.imul(G,st),e=e+Math.imul(V,nt)|0,f=Math.imul(V,st),h=h+Math.imul(W,ot)|0,e=e+Math.imul(W,at)|0,e=e+Math.imul(z,ot)|0,f=f+Math.imul(z,at)|0,h=h+Math.imul(K,ht)|0,e=e+Math.imul(K,ft)|0,e=e+Math.imul(Q,ht)|0,f=f+Math.imul(Q,ft)|0,h=h+Math.imul(J,ut)|0,e=e+Math.imul(J,ct)|0,e=e+Math.imul(D,ut)|0,f=f+Math.imul(D,ct)|0,h=h+Math.imul(H,lt)|0,e=e+Math.imul(H,dt)|0,e=e+Math.imul(Z,lt)|0,f=f+Math.imul(Z,dt)|0,h=h+Math.imul($,mt)|0,e=e+Math.imul($,pt)|0,e=e+Math.imul(P,mt)|0,f=f+Math.imul(P,pt)|0,h=h+Math.imul(B,gt)|0,e=e+Math.imul(B,vt)|0,e=e+Math.imul(L,gt)|0,f=f+Math.imul(L,vt)|0;var Yt=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(Yt>>>26)|0,Yt&=67108863,h=Math.imul(G,ot),e=Math.imul(G,at),e=e+Math.imul(V,ot)|0,f=Math.imul(V,at),h=h+Math.imul(W,ht)|0,e=e+Math.imul(W,ft)|0,e=e+Math.imul(z,ht)|0,f=f+Math.imul(z,ft)|0,h=h+Math.imul(K,ut)|0,e=e+Math.imul(K,ct)|0,e=e+Math.imul(Q,ut)|0,f=f+Math.imul(Q,ct)|0,h=h+Math.imul(J,lt)|0,e=e+Math.imul(J,dt)|0,e=e+Math.imul(D,lt)|0,f=f+Math.imul(D,dt)|0,h=h+Math.imul(H,mt)|0,e=e+Math.imul(H,pt)|0,e=e+Math.imul(Z,mt)|0,f=f+Math.imul(Z,pt)|0,h=h+Math.imul($,gt)|0,e=e+Math.imul($,vt)|0,e=e+Math.imul(P,gt)|0,f=f+Math.imul(P,vt)|0;var Xt=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(Xt>>>26)|0,Xt&=67108863,h=Math.imul(G,ht),e=Math.imul(G,ft),e=e+Math.imul(V,ht)|0,f=Math.imul(V,ft),h=h+Math.imul(W,ut)|0,e=e+Math.imul(W,ct)|0,e=e+Math.imul(z,ut)|0,f=f+Math.imul(z,ct)|0,h=h+Math.imul(K,lt)|0,e=e+Math.imul(K,dt)|0,e=e+Math.imul(Q,lt)|0,f=f+Math.imul(Q,dt)|0,h=h+Math.imul(J,mt)|0,e=e+Math.imul(J,pt)|0,e=e+Math.imul(D,mt)|0,f=f+Math.imul(D,pt)|0,h=h+Math.imul(H,gt)|0,e=e+Math.imul(H,vt)|0,e=e+Math.imul(Z,gt)|0,f=f+Math.imul(Z,vt)|0;var te=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(te>>>26)|0,te&=67108863,h=Math.imul(G,ut),e=Math.imul(G,ct),e=e+Math.imul(V,ut)|0,f=Math.imul(V,ct),h=h+Math.imul(W,lt)|0,e=e+Math.imul(W,dt)|0,e=e+Math.imul(z,lt)|0,f=f+Math.imul(z,dt)|0,h=h+Math.imul(K,mt)|0,e=e+Math.imul(K,pt)|0,e=e+Math.imul(Q,mt)|0,f=f+Math.imul(Q,pt)|0,h=h+Math.imul(J,gt)|0,e=e+Math.imul(J,vt)|0,e=e+Math.imul(D,gt)|0,f=f+Math.imul(D,vt)|0;var ee=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(ee>>>26)|0,ee&=67108863,h=Math.imul(G,lt),e=Math.imul(G,dt),e=e+Math.imul(V,lt)|0,f=Math.imul(V,dt),h=h+Math.imul(W,mt)|0,e=e+Math.imul(W,pt)|0,e=e+Math.imul(z,mt)|0,f=f+Math.imul(z,pt)|0,h=h+Math.imul(K,gt)|0,e=e+Math.imul(K,vt)|0,e=e+Math.imul(Q,gt)|0,f=f+Math.imul(Q,vt)|0;var re=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(re>>>26)|0,re&=67108863,h=Math.imul(G,mt),e=Math.imul(G,pt),e=e+Math.imul(V,mt)|0,f=Math.imul(V,pt),h=h+Math.imul(W,gt)|0,e=e+Math.imul(W,vt)|0,e=e+Math.imul(z,gt)|0,f=f+Math.imul(z,vt)|0;var ie=(M+h|0)+((e&8191)<<13)|0;M=(f+(e>>>13)|0)+(ie>>>26)|0,ie&=67108863,h=Math.imul(G,gt),e=Math.imul(G,vt),e=e+Math.imul(V,gt)|0,f=Math.imul(V,vt);var ne=(M+h|0)+((e&8191)<<13)|0;return M=(f+(e>>>13)|0)+(ne>>>26)|0,ne&=67108863,p[0]=$t,p[1]=Pt,p[2]=Ht,p[3]=Zt,p[4]=Jt,p[5]=Dt,p[6]=Kt,p[7]=Qt,p[8]=Wt,p[9]=zt,p[10]=Gt,p[11]=Vt,p[12]=Yt,p[13]=Xt,p[14]=te,p[15]=ee,p[16]=re,p[17]=ie,p[18]=ne,M!==0&&(p[19]=M,n.length++),n};Math.imul||(bt=yt);function St(m,t,r){r.negative=t.negative^m.negative,r.length=m.length+t.length;for(var n=0,o=0,u=0;u<r.length-1;u++){var p=o;o=0;for(var M=n&67108863,h=Math.min(u,t.length-1),e=Math.max(0,u-m.length+1);e<=h;e++){var f=u-e,x=m.words[f]|0,R=t.words[e]|0,k=x*R,O=k&67108863;p=p+(k/67108864|0)|0,O=O+M|0,M=O&67108863,p=p+(O>>>26)|0,o+=p>>>26,p&=67108863}r.words[u]=M,n=p,p=o}return n!==0?r.words[u]=n:r.length--,r.strip()}function s(m,t,r){var n=new l;return n.mulp(m,t,r)}d.prototype.mulTo=function(t,r){var n,o=this.length+t.length;return this.length===10&&t.length===10?n=bt(this,t,r):o<63?n=yt(this,t,r):o<1024?n=St(this,t,r):n=s(this,t,r),n};function l(m,t){this.x=m,this.y=t}l.prototype.makeRBT=function(t){for(var r=new Array(t),n=d.prototype._countBits(t)-1,o=0;o<t;o++)r[o]=this.revBin(o,n,t);return r},l.prototype.revBin=function(t,r,n){if(t===0||t===n-1)return t;for(var o=0,u=0;u<r;u++)o|=(t&1)<<r-u-1,t>>=1;return o},l.prototype.permute=function(t,r,n,o,u,p){for(var M=0;M<p;M++)o[M]=r[t[M]],u[M]=n[t[M]]},l.prototype.transform=function(t,r,n,o,u,p){this.permute(p,t,r,n,o,u);for(var M=1;M<u;M<<=1)for(var h=M<<1,e=Math.cos(2*Math.PI/h),f=Math.sin(2*Math.PI/h),x=0;x<u;x+=h)for(var R=e,k=f,O=0;O<M;O++){var q=n[x+O],N=o[x+O],xt=n[x+O+M],C=o[x+O+M],F=R*xt-k*C;C=R*C+k*xt,xt=F,n[x+O]=q+xt,o[x+O]=N+C,n[x+O+M]=q-xt,o[x+O+M]=N-C,O!==h&&(F=e*R-f*k,k=e*k+f*R,R=F)}},l.prototype.guessLen13b=function(t,r){var n=Math.max(r,t)|1,o=n&1,u=0;for(n=n/2|0;n;n=n>>>1)u++;return 1<<u+1+o},l.prototype.conjugate=function(t,r,n){if(!(n<=1))for(var o=0;o<n/2;o++){var u=t[o];t[o]=t[n-o-1],t[n-o-1]=u,u=r[o],r[o]=-r[n-o-1],r[n-o-1]=-u}},l.prototype.normalize13b=function(t,r){for(var n=0,o=0;o<r/2;o++){var u=Math.round(t[2*o+1]/r)*8192+Math.round(t[2*o]/r)+n;t[o]=u&67108863,u<67108864?n=0:n=u/67108864|0}return t},l.prototype.convert13b=function(t,r,n,o){for(var u=0,p=0;p<r;p++)u=u+(t[p]|0),n[2*p]=u&8191,u=u>>>13,n[2*p+1]=u&8191,u=u>>>13;for(p=2*r;p<o;++p)n[p]=0;g(u===0),g((u&-8192)===0)},l.prototype.stub=function(t){for(var r=new Array(t),n=0;n<t;n++)r[n]=0;return r},l.prototype.mulp=function(t,r,n){var o=2*this.guessLen13b(t.length,r.length),u=this.makeRBT(o),p=this.stub(o),M=new Array(o),h=new Array(o),e=new Array(o),f=new Array(o),x=new Array(o),R=new Array(o),k=n.words;k.length=o,this.convert13b(t.words,t.length,M,o),this.convert13b(r.words,r.length,f,o),this.transform(M,p,h,e,o,u),this.transform(f,p,x,R,o,u);for(var O=0;O<o;O++){var q=h[O]*x[O]-e[O]*R[O];e[O]=h[O]*R[O]+e[O]*x[O],h[O]=q}return this.conjugate(h,e,o),this.transform(h,e,k,p,o,u),this.conjugate(k,p,o),this.normalize13b(k,o),n.negative=t.negative^r.negative,n.length=t.length+r.length,n.strip()},d.prototype.mul=function(t){var r=new d(null);return r.words=new Array(this.length+t.length),this.mulTo(t,r)},d.prototype.mulf=function(t){var r=new d(null);return r.words=new Array(this.length+t.length),s(this,t,r)},d.prototype.imul=function(t){return this.clone().mulTo(t,this)},d.prototype.imuln=function(t){g(typeof t=="number"),g(t<67108864);for(var r=0,n=0;n<this.length;n++){var o=(this.words[n]|0)*t,u=(o&67108863)+(r&67108863);r>>=26,r+=o/67108864|0,r+=u>>>26,this.words[n]=u&67108863}return r!==0&&(this.words[n]=r,this.length++),this},d.prototype.muln=function(t){return this.clone().imuln(t)},d.prototype.sqr=function(){return this.mul(this)},d.prototype.isqr=function(){return this.imul(this.clone())},d.prototype.pow=function(t){var r=wt(t);if(r.length===0)return new d(1);for(var n=this,o=0;o<r.length&&r[o]===0;o++,n=n.sqr());if(++o<r.length)for(var u=n.sqr();o<r.length;o++,u=u.sqr())r[o]!==0&&(n=n.mul(u));return n},d.prototype.iushln=function(t){g(typeof t=="number"&&t>=0);var r=t%26,n=(t-r)/26,o=67108863>>>26-r<<26-r,u;if(r!==0){var p=0;for(u=0;u<this.length;u++){var M=this.words[u]&o,h=(this.words[u]|0)-M<<r;this.words[u]=h|p,p=M>>>26-r}p&&(this.words[u]=p,this.length++)}if(n!==0){for(u=this.length-1;u>=0;u--)this.words[u+n]=this.words[u];for(u=0;u<n;u++)this.words[u]=0;this.length+=n}return this.strip()},d.prototype.ishln=function(t){return g(this.negative===0),this.iushln(t)},d.prototype.iushrn=function(t,r,n){g(typeof t=="number"&&t>=0);var o;r?o=(r-r%26)/26:o=0;var u=t%26,p=Math.min((t-u)/26,this.length),M=67108863^67108863>>>u<<u,h=n;if(o-=p,o=Math.max(0,o),h){for(var e=0;e<p;e++)h.words[e]=this.words[e];h.length=p}if(p!==0)if(this.length>p)for(this.length-=p,e=0;e<this.length;e++)this.words[e]=this.words[e+p];else this.words[0]=0,this.length=1;var f=0;for(e=this.length-1;e>=0&&(f!==0||e>=o);e--){var x=this.words[e]|0;this.words[e]=f<<26-u|x>>>u,f=x&M}return h&&f!==0&&(h.words[h.length++]=f),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},d.prototype.ishrn=function(t,r,n){return g(this.negative===0),this.iushrn(t,r,n)},d.prototype.shln=function(t){return this.clone().ishln(t)},d.prototype.ushln=function(t){return this.clone().iushln(t)},d.prototype.shrn=function(t){return this.clone().ishrn(t)},d.prototype.ushrn=function(t){return this.clone().iushrn(t)},d.prototype.testn=function(t){g(typeof t=="number"&&t>=0);var r=t%26,n=(t-r)/26,o=1<<r;if(this.length<=n)return!1;var u=this.words[n];return!!(u&o)},d.prototype.imaskn=function(t){g(typeof t=="number"&&t>=0);var r=t%26,n=(t-r)/26;if(g(this.negative===0,"imaskn works only with positive numbers"),this.length<=n)return this;if(r!==0&&n++,this.length=Math.min(n,this.length),r!==0){var o=67108863^67108863>>>r<<r;this.words[this.length-1]&=o}return this.strip()},d.prototype.maskn=function(t){return this.clone().imaskn(t)},d.prototype.iaddn=function(t){return g(typeof t=="number"),g(t<67108864),t<0?this.isubn(-t):this.negative!==0?this.length===1&&(this.words[0]|0)<t?(this.words[0]=t-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},d.prototype._iaddn=function(t){this.words[0]+=t;for(var r=0;r<this.length&&this.words[r]>=67108864;r++)this.words[r]-=67108864,r===this.length-1?this.words[r+1]=1:this.words[r+1]++;return this.length=Math.max(this.length,r+1),this},d.prototype.isubn=function(t){if(g(typeof t=="number"),g(t<67108864),t<0)return this.iaddn(-t);if(this.negative!==0)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var r=0;r<this.length&&this.words[r]<0;r++)this.words[r]+=67108864,this.words[r+1]-=1;return this.strip()},d.prototype.addn=function(t){return this.clone().iaddn(t)},d.prototype.subn=function(t){return this.clone().isubn(t)},d.prototype.iabs=function(){return this.negative=0,this},d.prototype.abs=function(){return this.clone().iabs()},d.prototype._ishlnsubmul=function(t,r,n){var o=t.length+n,u;this._expand(o);var p,M=0;for(u=0;u<t.length;u++){p=(this.words[u+n]|0)+M;var h=(t.words[u]|0)*r;p-=h&67108863,M=(p>>26)-(h/67108864|0),this.words[u+n]=p&67108863}for(;u<this.length-n;u++)p=(this.words[u+n]|0)+M,M=p>>26,this.words[u+n]=p&67108863;if(M===0)return this.strip();for(g(M===-1),M=0,u=0;u<this.length;u++)p=-(this.words[u]|0)+M,M=p>>26,this.words[u]=p&67108863;return this.negative=1,this.strip()},d.prototype._wordDiv=function(t,r){var n=this.length-t.length,o=this.clone(),u=t,p=u.words[u.length-1]|0,M=this._countBits(p);n=26-M,n!==0&&(u=u.ushln(n),o.iushln(n),p=u.words[u.length-1]|0);var h=o.length-u.length,e;if(r!=="mod"){e=new d(null),e.length=h+1,e.words=new Array(e.length);for(var f=0;f<e.length;f++)e.words[f]=0}var x=o.clone()._ishlnsubmul(u,1,h);x.negative===0&&(o=x,e&&(e.words[h]=1));for(var R=h-1;R>=0;R--){var k=(o.words[u.length+R]|0)*67108864+(o.words[u.length+R-1]|0);for(k=Math.min(k/p|0,67108863),o._ishlnsubmul(u,k,R);o.negative!==0;)k--,o.negative=0,o._ishlnsubmul(u,1,R),o.isZero()||(o.negative^=1);e&&(e.words[R]=k)}return e&&e.strip(),o.strip(),r!=="div"&&n!==0&&o.iushrn(n),{div:e||null,mod:o}},d.prototype.divmod=function(t,r,n){if(g(!t.isZero()),this.isZero())return{div:new d(0),mod:new d(0)};var o,u,p;return this.negative!==0&&t.negative===0?(p=this.neg().divmod(t,r),r!=="mod"&&(o=p.div.neg()),r!=="div"&&(u=p.mod.neg(),n&&u.negative!==0&&u.iadd(t)),{div:o,mod:u}):this.negative===0&&t.negative!==0?(p=this.divmod(t.neg(),r),r!=="mod"&&(o=p.div.neg()),{div:o,mod:p.mod}):this.negative&t.negative?(p=this.neg().divmod(t.neg(),r),r!=="div"&&(u=p.mod.neg(),n&&u.negative!==0&&u.isub(t)),{div:p.div,mod:u}):t.length>this.length||this.cmp(t)<0?{div:new d(0),mod:this}:t.length===1?r==="div"?{div:this.divn(t.words[0]),mod:null}:r==="mod"?{div:null,mod:new d(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new d(this.modn(t.words[0]))}:this._wordDiv(t,r)},d.prototype.div=function(t){return this.divmod(t,"div",!1).div},d.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},d.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},d.prototype.divRound=function(t){var r=this.divmod(t);if(r.mod.isZero())return r.div;var n=r.div.negative!==0?r.mod.isub(t):r.mod,o=t.ushrn(1),u=t.andln(1),p=n.cmp(o);return p<0||u===1&&p===0?r.div:r.div.negative!==0?r.div.isubn(1):r.div.iaddn(1)},d.prototype.modn=function(t){g(t<=67108863);for(var r=(1<<26)%t,n=0,o=this.length-1;o>=0;o--)n=(r*n+(this.words[o]|0))%t;return n},d.prototype.idivn=function(t){g(t<=67108863);for(var r=0,n=this.length-1;n>=0;n--){var o=(this.words[n]|0)+r*67108864;this.words[n]=o/t|0,r=o%t}return this.strip()},d.prototype.divn=function(t){return this.clone().idivn(t)},d.prototype.egcd=function(t){g(t.negative===0),g(!t.isZero());var r=this,n=t.clone();r.negative!==0?r=r.umod(t):r=r.clone();for(var o=new d(1),u=new d(0),p=new d(0),M=new d(1),h=0;r.isEven()&&n.isEven();)r.iushrn(1),n.iushrn(1),++h;for(var e=n.clone(),f=r.clone();!r.isZero();){for(var x=0,R=1;!(r.words[0]&R)&&x<26;++x,R<<=1);if(x>0)for(r.iushrn(x);x-- >0;)(o.isOdd()||u.isOdd())&&(o.iadd(e),u.isub(f)),o.iushrn(1),u.iushrn(1);for(var k=0,O=1;!(n.words[0]&O)&&k<26;++k,O<<=1);if(k>0)for(n.iushrn(k);k-- >0;)(p.isOdd()||M.isOdd())&&(p.iadd(e),M.isub(f)),p.iushrn(1),M.iushrn(1);r.cmp(n)>=0?(r.isub(n),o.isub(p),u.isub(M)):(n.isub(r),p.isub(o),M.isub(u))}return{a:p,b:M,gcd:n.iushln(h)}},d.prototype._invmp=function(t){g(t.negative===0),g(!t.isZero());var r=this,n=t.clone();r.negative!==0?r=r.umod(t):r=r.clone();for(var o=new d(1),u=new d(0),p=n.clone();r.cmpn(1)>0&&n.cmpn(1)>0;){for(var M=0,h=1;!(r.words[0]&h)&&M<26;++M,h<<=1);if(M>0)for(r.iushrn(M);M-- >0;)o.isOdd()&&o.iadd(p),o.iushrn(1);for(var e=0,f=1;!(n.words[0]&f)&&e<26;++e,f<<=1);if(e>0)for(n.iushrn(e);e-- >0;)u.isOdd()&&u.iadd(p),u.iushrn(1);r.cmp(n)>=0?(r.isub(n),o.isub(u)):(n.isub(r),u.isub(o))}var x;return r.cmpn(1)===0?x=o:x=u,x.cmpn(0)<0&&x.iadd(t),x},d.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var r=this.clone(),n=t.clone();r.negative=0,n.negative=0;for(var o=0;r.isEven()&&n.isEven();o++)r.iushrn(1),n.iushrn(1);do{for(;r.isEven();)r.iushrn(1);for(;n.isEven();)n.iushrn(1);var u=r.cmp(n);if(u<0){var p=r;r=n,n=p}else if(u===0||n.cmpn(1)===0)break;r.isub(n)}while(!0);return n.iushln(o)},d.prototype.invm=function(t){return this.egcd(t).a.umod(t)},d.prototype.isEven=function(){return(this.words[0]&1)===0},d.prototype.isOdd=function(){return(this.words[0]&1)===1},d.prototype.andln=function(t){return this.words[0]&t},d.prototype.bincn=function(t){g(typeof t=="number");var r=t%26,n=(t-r)/26,o=1<<r;if(this.length<=n)return this._expand(n+1),this.words[n]|=o,this;for(var u=o,p=n;u!==0&&p<this.length;p++){var M=this.words[p]|0;M+=u,u=M>>>26,M&=67108863,this.words[p]=M}return u!==0&&(this.words[p]=u,this.length++),this},d.prototype.isZero=function(){return this.length===1&&this.words[0]===0},d.prototype.cmpn=function(t){var r=t<0;if(this.negative!==0&&!r)return-1;if(this.negative===0&&r)return 1;this.strip();var n;if(this.length>1)n=1;else{r&&(t=-t),g(t<=67108863,"Number is too big");var o=this.words[0]|0;n=o===t?0:o<t?-1:1}return this.negative!==0?-n|0:n},d.prototype.cmp=function(t){if(this.negative!==0&&t.negative===0)return-1;if(this.negative===0&&t.negative!==0)return 1;var r=this.ucmp(t);return this.negative!==0?-r|0:r},d.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var r=0,n=this.length-1;n>=0;n--){var o=this.words[n]|0,u=t.words[n]|0;if(o!==u){o<u?r=-1:o>u&&(r=1);break}}return r},d.prototype.gtn=function(t){return this.cmpn(t)===1},d.prototype.gt=function(t){return this.cmp(t)===1},d.prototype.gten=function(t){return this.cmpn(t)>=0},d.prototype.gte=function(t){return this.cmp(t)>=0},d.prototype.ltn=function(t){return this.cmpn(t)===-1},d.prototype.lt=function(t){return this.cmp(t)===-1},d.prototype.lten=function(t){return this.cmpn(t)<=0},d.prototype.lte=function(t){return this.cmp(t)<=0},d.prototype.eqn=function(t){return this.cmpn(t)===0},d.prototype.eq=function(t){return this.cmp(t)===0},d.red=function(t){return new U(t)},d.prototype.toRed=function(t){return g(!this.red,"Already a number in reduction context"),g(this.negative===0,"red works only with positives"),t.convertTo(this)._forceRed(t)},d.prototype.fromRed=function(){return g(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},d.prototype._forceRed=function(t){return this.red=t,this},d.prototype.forceRed=function(t){return g(!this.red,"Already a number in reduction context"),this._forceRed(t)},d.prototype.redAdd=function(t){return g(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},d.prototype.redIAdd=function(t){return g(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},d.prototype.redSub=function(t){return g(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},d.prototype.redISub=function(t){return g(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},d.prototype.redShl=function(t){return g(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},d.prototype.redMul=function(t){return g(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},d.prototype.redIMul=function(t){return g(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},d.prototype.redSqr=function(){return g(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},d.prototype.redISqr=function(){return g(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},d.prototype.redSqrt=function(){return g(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},d.prototype.redInvm=function(){return g(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},d.prototype.redNeg=function(){return g(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},d.prototype.redPow=function(t){return g(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var y={k256:null,p224:null,p192:null,p25519:null};function v(m,t){this.name=m,this.p=new d(t,16),this.n=this.p.bitLength(),this.k=new d(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}v.prototype._tmp=function(){var t=new d(null);return t.words=new Array(Math.ceil(this.n/13)),t},v.prototype.ireduce=function(t){var r=t,n;do this.split(r,this.tmp),r=this.imulK(r),r=r.iadd(this.tmp),n=r.bitLength();while(n>this.n);var o=n<this.n?-1:r.ucmp(this.p);return o===0?(r.words[0]=0,r.length=1):o>0?r.isub(this.p):r.strip(),r},v.prototype.split=function(t,r){t.iushrn(this.n,0,r)},v.prototype.imulK=function(t){return t.imul(this.k)};function w(){v.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}b(w,v),w.prototype.split=function(t,r){for(var n=4194303,o=Math.min(t.length,9),u=0;u<o;u++)r.words[u]=t.words[u];if(r.length=o,t.length<=9){t.words[0]=0,t.length=1;return}var p=t.words[9];for(r.words[r.length++]=p&n,u=10;u<t.length;u++){var M=t.words[u]|0;t.words[u-10]=(M&n)<<4|p>>>22,p=M}p>>>=22,t.words[u-10]=p,p===0&&t.length>10?t.length-=10:t.length-=9},w.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var r=0,n=0;n<t.length;n++){var o=t.words[n]|0;r+=o*977,t.words[n]=r&67108863,r=o*64+(r/67108864|0)}return t.words[t.length-1]===0&&(t.length--,t.words[t.length-1]===0&&t.length--),t};function I(){v.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}b(I,v);function _(){v.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}b(_,v);function E(){v.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}b(E,v),E.prototype.imulK=function(t){for(var r=0,n=0;n<t.length;n++){var o=(t.words[n]|0)*19+r,u=o&67108863;o>>>=26,t.words[n]=u,r=o}return r!==0&&(t.words[t.length++]=r),t},d._prime=function(t){if(y[t])return y[t];var r;if(t==="k256")r=new w;else if(t==="p224")r=new I;else if(t==="p192")r=new _;else if(t==="p25519")r=new E;else throw new Error("Unknown prime "+t);return y[t]=r,r};function U(m){if(typeof m=="string"){var t=d._prime(m);this.m=t.p,this.prime=t}else g(m.gtn(1),"modulus must be greater than 1"),this.m=m,this.prime=null}U.prototype._verify1=function(t){g(t.negative===0,"red works only with positives"),g(t.red,"red works only with red numbers")},U.prototype._verify2=function(t,r){g((t.negative|r.negative)===0,"red works only with positives"),g(t.red&&t.red===r.red,"red works only with red numbers")},U.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},U.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},U.prototype.add=function(t,r){this._verify2(t,r);var n=t.add(r);return n.cmp(this.m)>=0&&n.isub(this.m),n._forceRed(this)},U.prototype.iadd=function(t,r){this._verify2(t,r);var n=t.iadd(r);return n.cmp(this.m)>=0&&n.isub(this.m),n},U.prototype.sub=function(t,r){this._verify2(t,r);var n=t.sub(r);return n.cmpn(0)<0&&n.iadd(this.m),n._forceRed(this)},U.prototype.isub=function(t,r){this._verify2(t,r);var n=t.isub(r);return n.cmpn(0)<0&&n.iadd(this.m),n},U.prototype.shl=function(t,r){return this._verify1(t),this.imod(t.ushln(r))},U.prototype.imul=function(t,r){return this._verify2(t,r),this.imod(t.imul(r))},U.prototype.mul=function(t,r){return this._verify2(t,r),this.imod(t.mul(r))},U.prototype.isqr=function(t){return this.imul(t,t.clone())},U.prototype.sqr=function(t){return this.mul(t,t)},U.prototype.sqrt=function(t){if(t.isZero())return t.clone();var r=this.m.andln(3);if(g(r%2===1),r===3){var n=this.m.add(new d(1)).iushrn(2);return this.pow(t,n)}for(var o=this.m.subn(1),u=0;!o.isZero()&&o.andln(1)===0;)u++,o.iushrn(1);g(!o.isZero());var p=new d(1).toRed(this),M=p.redNeg(),h=this.m.subn(1).iushrn(1),e=this.m.bitLength();for(e=new d(2*e*e).toRed(this);this.pow(e,h).cmp(M)!==0;)e.redIAdd(M);for(var f=this.pow(e,o),x=this.pow(t,o.addn(1).iushrn(1)),R=this.pow(t,o),k=u;R.cmp(p)!==0;){for(var O=R,q=0;O.cmp(p)!==0;q++)O=O.redSqr();g(q<k);var N=this.pow(f,new d(1).iushln(k-q-1));x=x.redMul(N),f=N.redSqr(),R=R.redMul(f),k=q}return x},U.prototype.invm=function(t){var r=t._invmp(this.m);return r.negative!==0?(r.negative=0,this.imod(r).redNeg()):this.imod(r)},U.prototype.pow=function(t,r){if(r.isZero())return new d(1).toRed(this);if(r.cmpn(1)===0)return t.clone();var n=4,o=new Array(1<<n);o[0]=new d(1).toRed(this),o[1]=t;for(var u=2;u<o.length;u++)o[u]=this.mul(o[u-1],t);var p=o[0],M=0,h=0,e=r.bitLength()%26;for(e===0&&(e=26),u=r.length-1;u>=0;u--){for(var f=r.words[u],x=e-1;x>=0;x--){var R=f>>x&1;if(p!==o[0]&&(p=this.sqr(p)),R===0&&M===0){h=0;continue}M<<=1,M|=R,h++,!(h!==n&&(u!==0||x!==0))&&(p=this.mul(p,o[M]),h=0,M=0)}e=26}return p},U.prototype.convertTo=function(t){var r=t.umod(this.m);return r===t?r.clone():r},U.prototype.convertFrom=function(t){var r=t.clone();return r.red=null,r},d.mont=function(t){return new kt(t)};function kt(m){U.call(this,m),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new d(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}b(kt,U),kt.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},kt.prototype.convertFrom=function(t){var r=this.imod(t.mul(this.rinv));return r.red=null,r},kt.prototype.imul=function(t,r){if(t.isZero()||r.isZero())return t.words[0]=0,t.length=1,t;var n=t.imul(r),o=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),u=n.isub(o).iushrn(this.shift),p=u;return u.cmp(this.m)>=0?p=u.isub(this.m):u.cmpn(0)<0&&(p=u.iadd(this.m)),p._forceRed(this)},kt.prototype.mul=function(t,r){if(t.isZero()||r.isZero())return new d(0)._forceRed(this);var n=t.mul(r),o=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),u=n.isub(o).iushrn(this.shift),p=u;return u.cmp(this.m)>=0?p=u.isub(this.m):u.cmpn(0)<0&&(p=u.iadd(this.m)),p._forceRed(this)},kt.prototype.invm=function(t){var r=this.imod(t._invmp(this.m).mul(this.r2));return r._forceRed(this)}})(a,mr)})(de);var yr=de.exports;const Mr=Je(yr);var wr=me;me.strict=Ke;me.loose=Qe;var _r=Object.prototype.toString,br={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function me(a){return Ke(a)||Qe(a)}function Ke(a){return a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Uint8Array||a instanceof Uint8ClampedArray||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array}function Qe(a){return br[_r.call(a)]}var Sr=wr.strict,xr=function(i){if(Sr(i)){var c=jt.Buffer.from(i.buffer);return i.byteLength!==i.buffer.byteLength&&(c=c.slice(i.byteOffset,i.byteOffset+i.byteLength)),c}else return jt.Buffer.from(i)};const Ir=Je(xr),We="hex",ze="utf8",Bt="0";function qt(a){return new Uint8Array(a)}function Ge(a,i=!1){const c=a.toString(We);return i?Tt(c):c}function Rr(a){return a.toString(ze)}function Lt(a){return Ir(a)}function Et(a,i=!1){return Ge(Lt(a),i)}function kr(a){return Rr(Lt(a))}function Or(a){return jt.Buffer.from(It(a),We)}function At(a){return qt(Or(a))}function pe(a){return jt.Buffer.from(a,ze)}function Er(a){return qt(pe(a))}function Ar(a,i=!1){return Ge(pe(a),i)}function qr(a,i){return!(typeof a!="string"||!a.match(/^0x[0-9A-Fa-f]*$/)||i&&a.length!==2+2*i)}function Ve(...a){let i=[];return a.forEach(c=>i=i.concat(Array.from(c))),new Uint8Array([...i])}function Tr(a,i=8){const c=a%i;return c?(a-c)/i*i+i:a}function Nr(a,i=8,c=Bt){return Cr(a,Tr(a.length,i),c)}function Cr(a,i,c=Bt){return jr(a,i,!0,c)}function It(a){return a.replace(/^0x/,"")}function Tt(a){return a.startsWith("0x")?a:`0x${a}`}function Ye(a){return a=It(a),a=Nr(a,2),a&&(a=Tt(a)),a}function Fr(a){const i=a.startsWith("0x");return a=It(a),a=a.startsWith(Bt)?a.substring(1):a,i?Tt(a):a}function jr(a,i,c,g=Bt){const b=i-a.length;let d=a;if(b>0){const A=g.repeat(b);d=c?A+a:a+A}return d}function Ur(a,i){return Et(new Uint8Array(a),!i)}function Br(a){return pe(a)}function Lr(a,i){return Ar(a,!i)}function $r(a){return At(a).buffer}function Xe(a,i){const c=It(Ye(new Mr(a).toString(16)));return i?c:Tt(c)}function Ft(a){return Ye(a)}function Pr(a){return Fr(Tt(a))}const Hr=gr;function se(){return((i,c)=>{for(c=i="";i++<36;c+=i*51&52?(i^15?8^Math.random()*(i^20?16:4):4).toString(16):"-");return c})()}function Zr(a){return a===""||typeof a=="string"&&a.trim()===""}function Jr(a){return!(a&&a.length)}function tr(a,i){return qr(a,i)}function Dr(a){return typeof a.method<"u"}function Nt(a){return typeof a.result<"u"}function Ut(a){return typeof a.error<"u"}function Be(a){return typeof a.event<"u"}function Kr(a){return vr.includes(a)||a.startsWith("wc_")}function Qr(a){return a.method.startsWith("wc_")?!0:!De.includes(a.method)}function Wr(a){a=It(a.toLowerCase());const i=It(pr.keccak_256(Br(a)));let c="";for(let g=0;g<a.length;g++)parseInt(i[g],16)>7?c+=a[g].toUpperCase():c+=a[g];return Tt(c)}const zr=a=>a?a.toLowerCase().substring(0,2)!=="0x"?!1:/^(0x)?[0-9a-f]{40}$/i.test(a)?/^(0x)?[0-9a-f]{40}$/.test(a)||/^(0x)?[0-9A-F]{40}$/.test(a)?!0:a===Wr(a):!1:!1;function Le(a){return!Jr(a)&&!tr(a[0])&&(a[0]=Lr(a[0])),a}function oe(a){if(typeof a.type<"u"&&a.type!=="0")return a;if(typeof a.from>"u"||!zr(a.from))throw new Error("Transaction object must include a valid 'from' value.");function i(b){let d=b;return(typeof b=="number"||typeof b=="string"&&!Zr(b))&&(tr(b)?typeof b=="string"&&(d=Ft(b)):d=Xe(b)),typeof d=="string"&&(d=Pr(d)),d}const c={from:Ft(a.from),to:typeof a.to>"u"?void 0:Ft(a.to),gasPrice:typeof a.gasPrice>"u"?"":i(a.gasPrice),gas:typeof a.gas>"u"?typeof a.gasLimit>"u"?"":i(a.gasLimit):i(a.gas),value:typeof a.value>"u"?"":i(a.value),nonce:typeof a.nonce>"u"?"":i(a.nonce),data:typeof a.data>"u"?"":Ft(a.data)||"0x"},g=["gasPrice","gas","value","nonce"];return Object.keys(c).forEach(b=>{(typeof c[b]>"u"||typeof c[b]=="string"&&!c[b].trim().length)&&g.includes(b)&&delete c[b]}),c}function Gr(a){const i=a.message||"Failed or Rejected Request";let c=-32e3;if(a&&!a.code)switch(i){case"Parse error":c=-32700;break;case"Invalid request":c=-32600;break;case"Method not found":c=-32601;break;case"Invalid params":c=-32602;break;case"Internal error":c=-32603;break;default:c=-32e3;break}const g={code:c,message:i};return a.data&&(g.data=a.data),g}var er={};(function(a){const i=ce,c=le,g=ue,b=s=>s==null;function d(s){switch(s.arrayFormat){case"index":return l=>(y,v)=>{const w=y.length;return v===void 0||s.skipNull&&v===null||s.skipEmptyString&&v===""?y:v===null?[...y,[S(l,s),"[",w,"]"].join("")]:[...y,[S(l,s),"[",S(w,s),"]=",S(v,s)].join("")]};case"bracket":return l=>(y,v)=>v===void 0||s.skipNull&&v===null||s.skipEmptyString&&v===""?y:v===null?[...y,[S(l,s),"[]"].join("")]:[...y,[S(l,s),"[]=",S(v,s)].join("")];case"comma":case"separator":return l=>(y,v)=>v==null||v.length===0?y:y.length===0?[[S(l,s),"=",S(v,s)].join("")]:[[y,S(v,s)].join(s.arrayFormatSeparator)];default:return l=>(y,v)=>v===void 0||s.skipNull&&v===null||s.skipEmptyString&&v===""?y:v===null?[...y,S(l,s)]:[...y,[S(l,s),"=",S(v,s)].join("")]}}function A(s){let l;switch(s.arrayFormat){case"index":return(y,v,w)=>{if(l=/\[(\d*)\]$/.exec(y),y=y.replace(/\[\d*\]$/,""),!l){w[y]=v;return}w[y]===void 0&&(w[y]={}),w[y][l[1]]=v};case"bracket":return(y,v,w)=>{if(l=/(\[\])$/.exec(y),y=y.replace(/\[\]$/,""),!l){w[y]=v;return}if(w[y]===void 0){w[y]=[v];return}w[y]=[].concat(w[y],v)};case"comma":case"separator":return(y,v,w)=>{const _=typeof v=="string"&&v.split("").indexOf(s.arrayFormatSeparator)>-1?v.split(s.arrayFormatSeparator).map(E=>T(E,s)):v===null?v:T(v,s);w[y]=_};default:return(y,v,w)=>{if(w[y]===void 0){w[y]=v;return}w[y]=[].concat(w[y],v)}}}function j(s){if(typeof s!="string"||s.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function S(s,l){return l.encode?l.strict?i(s):encodeURIComponent(s):s}function T(s,l){return l.decode?c(s):s}function _t(s){return Array.isArray(s)?s.sort():typeof s=="object"?_t(Object.keys(s)).sort((l,y)=>Number(l)-Number(y)).map(l=>s[l]):s}function Mt(s){const l=s.indexOf("#");return l!==-1&&(s=s.slice(0,l)),s}function wt(s){let l="";const y=s.indexOf("#");return y!==-1&&(l=s.slice(y)),l}function yt(s){s=Mt(s);const l=s.indexOf("?");return l===-1?"":s.slice(l+1)}function bt(s,l){return l.parseNumbers&&!Number.isNaN(Number(s))&&typeof s=="string"&&s.trim()!==""?s=Number(s):l.parseBooleans&&s!==null&&(s.toLowerCase()==="true"||s.toLowerCase()==="false")&&(s=s.toLowerCase()==="true"),s}function St(s,l){l=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},l),j(l.arrayFormatSeparator);const y=A(l),v=Object.create(null);if(typeof s!="string"||(s=s.trim().replace(/^[?#&]/,""),!s))return v;for(const w of s.split("&")){let[I,_]=g(l.decode?w.replace(/\+/g," "):w,"=");_=_===void 0?null:["comma","separator"].includes(l.arrayFormat)?_:T(_,l),y(T(I,l),_,v)}for(const w of Object.keys(v)){const I=v[w];if(typeof I=="object"&&I!==null)for(const _ of Object.keys(I))I[_]=bt(I[_],l);else v[w]=bt(I,l)}return l.sort===!1?v:(l.sort===!0?Object.keys(v).sort():Object.keys(v).sort(l.sort)).reduce((w,I)=>{const _=v[I];return _&&typeof _=="object"&&!Array.isArray(_)?w[I]=_t(_):w[I]=_,w},Object.create(null))}a.extract=yt,a.parse=St,a.stringify=(s,l)=>{if(!s)return"";l=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},l),j(l.arrayFormatSeparator);const y=_=>l.skipNull&&b(s[_])||l.skipEmptyString&&s[_]==="",v=d(l),w={};for(const _ of Object.keys(s))y(_)||(w[_]=s[_]);const I=Object.keys(w);return l.sort!==!1&&I.sort(l.sort),I.map(_=>{const E=s[_];return E===void 0?"":E===null?S(_,l):Array.isArray(E)?E.reduce(v(_),[]).join("&"):S(_,l)+"="+S(E,l)}).filter(_=>_.length>0).join("&")},a.parseUrl=(s,l)=>{l=Object.assign({decode:!0},l);const[y,v]=g(s,"#");return Object.assign({url:y.split("?")[0]||"",query:St(yt(s),l)},l&&l.parseFragmentIdentifier&&v?{fragmentIdentifier:T(v,l)}:{})},a.stringifyUrl=(s,l)=>{l=Object.assign({encode:!0,strict:!0},l);const y=Mt(s.url).split("?")[0]||"",v=a.extract(s.url),w=a.parse(v,{sort:!1}),I=Object.assign(w,s.query);let _=a.stringify(I,l);_&&(_=`?${_}`);let E=wt(s.url);return s.fragmentIdentifier&&(E=`#${S(s.fragmentIdentifier,l)}`),`${y}${_}${E}`}})(er);function Vr(a){return er.parse(a)}function Yr(a){return typeof a.bridge<"u"}function Xr(a){const i=a.indexOf(":"),c=a.indexOf("?")!==-1?a.indexOf("?"):void 0,g=a.substring(0,i),b=a.substring(i+1,c);function d(Mt){const wt="@",yt=Mt.split(wt);return{handshakeTopic:yt[0],version:parseInt(yt[1],10)}}const A=d(b),j=typeof c<"u"?a.substr(c):"";function S(Mt){const wt=Vr(Mt);return{key:wt.key||"",bridge:wt.bridge||""}}const T=S(j);return Object.assign(Object.assign({protocol:g},A),T)}var ge={};(function(a){const i=ce,c=le,g=ue,b=s=>s==null;function d(s){switch(s.arrayFormat){case"index":return l=>(y,v)=>{const w=y.length;return v===void 0||s.skipNull&&v===null||s.skipEmptyString&&v===""?y:v===null?[...y,[S(l,s),"[",w,"]"].join("")]:[...y,[S(l,s),"[",S(w,s),"]=",S(v,s)].join("")]};case"bracket":return l=>(y,v)=>v===void 0||s.skipNull&&v===null||s.skipEmptyString&&v===""?y:v===null?[...y,[S(l,s),"[]"].join("")]:[...y,[S(l,s),"[]=",S(v,s)].join("")];case"comma":case"separator":return l=>(y,v)=>v==null||v.length===0?y:y.length===0?[[S(l,s),"=",S(v,s)].join("")]:[[y,S(v,s)].join(s.arrayFormatSeparator)];default:return l=>(y,v)=>v===void 0||s.skipNull&&v===null||s.skipEmptyString&&v===""?y:v===null?[...y,S(l,s)]:[...y,[S(l,s),"=",S(v,s)].join("")]}}function A(s){let l;switch(s.arrayFormat){case"index":return(y,v,w)=>{if(l=/\[(\d*)\]$/.exec(y),y=y.replace(/\[\d*\]$/,""),!l){w[y]=v;return}w[y]===void 0&&(w[y]={}),w[y][l[1]]=v};case"bracket":return(y,v,w)=>{if(l=/(\[\])$/.exec(y),y=y.replace(/\[\]$/,""),!l){w[y]=v;return}if(w[y]===void 0){w[y]=[v];return}w[y]=[].concat(w[y],v)};case"comma":case"separator":return(y,v,w)=>{const _=typeof v=="string"&&v.split("").indexOf(s.arrayFormatSeparator)>-1?v.split(s.arrayFormatSeparator).map(E=>T(E,s)):v===null?v:T(v,s);w[y]=_};default:return(y,v,w)=>{if(w[y]===void 0){w[y]=v;return}w[y]=[].concat(w[y],v)}}}function j(s){if(typeof s!="string"||s.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function S(s,l){return l.encode?l.strict?i(s):encodeURIComponent(s):s}function T(s,l){return l.decode?c(s):s}function _t(s){return Array.isArray(s)?s.sort():typeof s=="object"?_t(Object.keys(s)).sort((l,y)=>Number(l)-Number(y)).map(l=>s[l]):s}function Mt(s){const l=s.indexOf("#");return l!==-1&&(s=s.slice(0,l)),s}function wt(s){let l="";const y=s.indexOf("#");return y!==-1&&(l=s.slice(y)),l}function yt(s){s=Mt(s);const l=s.indexOf("?");return l===-1?"":s.slice(l+1)}function bt(s,l){return l.parseNumbers&&!Number.isNaN(Number(s))&&typeof s=="string"&&s.trim()!==""?s=Number(s):l.parseBooleans&&s!==null&&(s.toLowerCase()==="true"||s.toLowerCase()==="false")&&(s=s.toLowerCase()==="true"),s}function St(s,l){l=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},l),j(l.arrayFormatSeparator);const y=A(l),v=Object.create(null);if(typeof s!="string"||(s=s.trim().replace(/^[?#&]/,""),!s))return v;for(const w of s.split("&")){let[I,_]=g(l.decode?w.replace(/\+/g," "):w,"=");_=_===void 0?null:["comma","separator"].includes(l.arrayFormat)?_:T(_,l),y(T(I,l),_,v)}for(const w of Object.keys(v)){const I=v[w];if(typeof I=="object"&&I!==null)for(const _ of Object.keys(I))I[_]=bt(I[_],l);else v[w]=bt(I,l)}return l.sort===!1?v:(l.sort===!0?Object.keys(v).sort():Object.keys(v).sort(l.sort)).reduce((w,I)=>{const _=v[I];return _&&typeof _=="object"&&!Array.isArray(_)?w[I]=_t(_):w[I]=_,w},Object.create(null))}a.extract=yt,a.parse=St,a.stringify=(s,l)=>{if(!s)return"";l=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},l),j(l.arrayFormatSeparator);const y=_=>l.skipNull&&b(s[_])||l.skipEmptyString&&s[_]==="",v=d(l),w={};for(const _ of Object.keys(s))y(_)||(w[_]=s[_]);const I=Object.keys(w);return l.sort!==!1&&I.sort(l.sort),I.map(_=>{const E=s[_];return E===void 0?"":E===null?S(_,l):Array.isArray(E)?E.reduce(v(_),[]).join("&"):S(_,l)+"="+S(E,l)}).filter(_=>_.length>0).join("&")},a.parseUrl=(s,l)=>{l=Object.assign({decode:!0},l);const[y,v]=g(s,"#");return Object.assign({url:y.split("?")[0]||"",query:St(yt(s),l)},l&&l.parseFragmentIdentifier&&v?{fragmentIdentifier:T(v,l)}:{})},a.stringifyUrl=(s,l)=>{l=Object.assign({encode:!0,strict:!0},l);const y=Mt(s.url).split("?")[0]||"",v=a.extract(s.url),w=a.parse(v,{sort:!1}),I=Object.assign(w,s.query);let _=a.stringify(I,l);_&&(_=`?${_}`);let E=wt(s.url);return s.fragmentIdentifier&&(E=`#${S(s.fragmentIdentifier,l)}`),`${y}${_}${E}`}})(ge);function ti(a){const i=a.indexOf("?")!==-1?a.indexOf("?"):void 0;return typeof i<"u"?a.substr(i):""}function ei(a,i){let c=ri(a);return c=Object.assign(Object.assign({},c),i),a=ii(c),a}function ri(a){return ge.parse(a)}function ii(a){return ge.stringify(a)}class ni{constructor(){this._eventEmitters=[],typeof window<"u"&&typeof window.addEventListener<"u"&&(window.addEventListener("online",()=>this.trigger("online")),window.addEventListener("offline",()=>this.trigger("offline")))}on(i,c){this._eventEmitters.push({event:i,callback:c})}trigger(i){let c=[];i&&(c=this._eventEmitters.filter(g=>g.event===i)),c.forEach(g=>{g.callback()})}}const si=typeof Ue.WebSocket<"u"?Ue.WebSocket:require("ws");class oi{constructor(i){if(this.opts=i,this._queue=[],this._events=[],this._subscriptions=[],this._protocol=i.protocol,this._version=i.version,this._url="",this._netMonitor=null,this._socket=null,this._nextSocket=null,this._subscriptions=i.subscriptions||[],this._netMonitor=i.netMonitor||new ni,!i.url||typeof i.url!="string")throw new Error("Missing or invalid WebSocket url");this._url=i.url,this._netMonitor.on("online",()=>this._socketCreate())}set readyState(i){}get readyState(){return this._socket?this._socket.readyState:-1}set connecting(i){}get connecting(){return this.readyState===0}set connected(i){}get connected(){return this.readyState===1}set closing(i){}get closing(){return this.readyState===2}set closed(i){}get closed(){return this.readyState===3}open(){this._socketCreate()}close(){this._socketClose()}send(i,c,g){if(!c||typeof c!="string")throw new Error("Missing or invalid topic field");this._socketSend({topic:c,type:"pub",payload:i,silent:!!g})}subscribe(i){this._socketSend({topic:i,type:"sub",payload:"",silent:!0})}on(i,c){this._events.push({event:i,callback:c})}_socketCreate(){if(this._nextSocket)return;const i=ai(this._url,this._protocol,this._version);if(this._nextSocket=new si(i),!this._nextSocket)throw new Error("Failed to create socket");this._nextSocket.onmessage=c=>this._socketReceive(c),this._nextSocket.onopen=()=>this._socketOpen(),this._nextSocket.onerror=c=>this._socketError(c),this._nextSocket.onclose=()=>{setTimeout(()=>{this._nextSocket=null,this._socketCreate()},1e3)}}_socketOpen(){this._socketClose(),this._socket=this._nextSocket,this._nextSocket=null,this._queueSubscriptions(),this._pushQueue()}_socketClose(){this._socket&&(this._socket.onclose=()=>{},this._socket.close())}_socketSend(i){const c=JSON.stringify(i);this._socket&&this._socket.readyState===1?this._socket.send(c):(this._setToQueue(i),this._socketCreate())}async _socketReceive(i){let c;try{c=JSON.parse(i.data)}catch{return}if(this._socketSend({topic:c.topic,type:"ack",payload:"",silent:!0}),this._socket&&this._socket.readyState===1){const g=this._events.filter(b=>b.event==="message");g&&g.length&&g.forEach(b=>b.callback(c))}}_socketError(i){const c=this._events.filter(g=>g.event==="error");c&&c.length&&c.forEach(g=>g.callback(i))}_queueSubscriptions(){this._subscriptions.forEach(c=>this._queue.push({topic:c,type:"sub",payload:"",silent:!0})),this._subscriptions=this.opts.subscriptions||[]}_setToQueue(i){this._queue.push(i)}_pushQueue(){this._queue.forEach(c=>this._socketSend(c)),this._queue=[]}}function ai(a,i,c){var g,b;const A=(a.startsWith("https")?a.replace("https","wss"):a.startsWith("http")?a.replace("http","ws"):a).split("?"),j=hr()?{protocol:i,version:c,env:"browser",host:((g=fr())===null||g===void 0?void 0:g.host)||""}:{protocol:i,version:c,env:((b=ur())===null||b===void 0?void 0:b.name)||""},S=ei(ti(A[1]||""),j);return A[0]+"?"+S}const ae="Session currently connected",Ot="Session currently disconnected",hi="Session Rejected",fi="Missing JSON RPC response",ui='JSON-RPC success response must include "result" field',ci='JSON-RPC error response must include "error" field',li='JSON RPC request must have valid "method" value',di='JSON RPC request must have valid "id" value',mi="Missing one of the required parameters: bridge / uri / session",$e="JSON RPC response format is invalid",pi="URI format is invalid",gi="QRCode Modal not provided",Pe="User close QRCode Modal";class vi{constructor(){this._eventEmitters=[]}subscribe(i){this._eventEmitters.push(i)}unsubscribe(i){this._eventEmitters=this._eventEmitters.filter(c=>c.event!==i)}trigger(i){let c=[],g;Dr(i)?g=i.method:Nt(i)||Ut(i)?g=`response:${i.id}`:Be(i)?g=i.event:g="",g&&(c=this._eventEmitters.filter(b=>b.event===g)),(!c||!c.length)&&!Kr(g)&&!Be(g)&&(c=this._eventEmitters.filter(b=>b.event==="call_request")),c.forEach(b=>{if(Ut(i)){const d=new Error(i.error.message);b.callback(d,null)}else b.callback(null,i)})}}class yi{constructor(i="walletconnect"){this.storageId=i}getSession(){let i=null;const c=He(this.storageId);return c&&Yr(c)&&(i=c),i}setSession(i){return cr(this.storageId,i),i}removeSession(){Ze(this.storageId)}}const Mi="walletconnect.org",wi="abcdefghijklmnopqrstuvwxyz0123456789",rr=wi.split("").map(a=>`https://${a}.bridge.walletconnect.org`);function _i(a){let i=a.indexOf("//")>-1?a.split("/")[2]:a.split("/")[0];return i=i.split(":")[0],i=i.split("?")[0],i}function bi(a){return _i(a).split(".").slice(-2).join(".")}function Si(){return Math.floor(Math.random()*rr.length)}function xi(){return rr[Si()]}function Ii(a){return bi(a)===Mi}function Ri(a){return Ii(a)?xi():a}class ki{constructor(i){if(this.protocol="wc",this.version=1,this._bridge="",this._key=null,this._clientId="",this._clientMeta=null,this._peerId="",this._peerMeta=null,this._handshakeId=0,this._handshakeTopic="",this._connected=!1,this._accounts=[],this._chainId=0,this._networkId=0,this._rpcUrl="",this._eventManager=new vi,this._clientMeta=Fe()||i.connectorOpts.clientMeta||null,this._cryptoLib=i.cryptoLib,this._sessionStorage=i.sessionStorage||new yi(i.connectorOpts.storageId),this._qrcodeModal=i.connectorOpts.qrcodeModal,this._qrcodeModalOptions=i.connectorOpts.qrcodeModalOptions,this._signingMethods=[...De,...i.connectorOpts.signingMethods||[]],!i.connectorOpts.bridge&&!i.connectorOpts.uri&&!i.connectorOpts.session)throw new Error(mi);i.connectorOpts.bridge&&(this.bridge=Ri(i.connectorOpts.bridge)),i.connectorOpts.uri&&(this.uri=i.connectorOpts.uri);const c=i.connectorOpts.session||this._getStorageSession();c&&(this.session=c),this.handshakeId&&this._subscribeToSessionResponse(this.handshakeId,"Session request rejected"),this._transport=i.transport||new oi({protocol:this.protocol,version:this.version,url:this.bridge,subscriptions:[this.clientId]}),this._subscribeToInternalEvents(),this._initTransport(),i.connectorOpts.uri&&this._subscribeToSessionRequest(),i.pushServerOpts&&this._registerPushServer(i.pushServerOpts)}set bridge(i){i&&(this._bridge=i)}get bridge(){return this._bridge}set key(i){if(!i)return;const c=$r(i);this._key=c}get key(){return this._key?Ur(this._key,!0):""}set clientId(i){i&&(this._clientId=i)}get clientId(){let i=this._clientId;return i||(i=this._clientId=se()),this._clientId}set peerId(i){i&&(this._peerId=i)}get peerId(){return this._peerId}set clientMeta(i){}get clientMeta(){let i=this._clientMeta;return i||(i=this._clientMeta=Fe()),i}set peerMeta(i){this._peerMeta=i}get peerMeta(){return this._peerMeta}set handshakeTopic(i){i&&(this._handshakeTopic=i)}get handshakeTopic(){return this._handshakeTopic}set handshakeId(i){i&&(this._handshakeId=i)}get handshakeId(){return this._handshakeId}get uri(){return this._formatUri()}set uri(i){if(!i)return;const{handshakeTopic:c,bridge:g,key:b}=this._parseUri(i);this.handshakeTopic=c,this.bridge=g,this.key=b}set chainId(i){this._chainId=i}get chainId(){return this._chainId}set networkId(i){this._networkId=i}get networkId(){return this._networkId}set accounts(i){this._accounts=i}get accounts(){return this._accounts}set rpcUrl(i){this._rpcUrl=i}get rpcUrl(){return this._rpcUrl}set connected(i){}get connected(){return this._connected}set pending(i){}get pending(){return!!this._handshakeTopic}get session(){return{connected:this.connected,accounts:this.accounts,chainId:this.chainId,bridge:this.bridge,key:this.key,clientId:this.clientId,clientMeta:this.clientMeta,peerId:this.peerId,peerMeta:this.peerMeta,handshakeId:this.handshakeId,handshakeTopic:this.handshakeTopic}}set session(i){i&&(this._connected=i.connected,this.accounts=i.accounts,this.chainId=i.chainId,this.bridge=i.bridge,this.key=i.key,this.clientId=i.clientId,this.clientMeta=i.clientMeta,this.peerId=i.peerId,this.peerMeta=i.peerMeta,this.handshakeId=i.handshakeId,this.handshakeTopic=i.handshakeTopic)}on(i,c){const g={event:i,callback:c};this._eventManager.subscribe(g)}off(i){this._eventManager.unsubscribe(i)}async createInstantRequest(i){this._key=await this._generateKey();const c=this._formatRequest({method:"wc_instantRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,request:this._formatRequest(i)}]});this.handshakeId=c.id,this.handshakeTopic=se(),this._eventManager.trigger({event:"display_uri",params:[this.uri]}),this.on("modal_closed",()=>{throw new Error(Pe)});const g=()=>{this.killSession()};try{const b=await this._sendCallRequest(c);return b&&g(),b}catch(b){throw g(),b}}async connect(i){if(!this._qrcodeModal)throw new Error(gi);return this.connected?{chainId:this.chainId,accounts:this.accounts}:(await this.createSession(i),new Promise(async(c,g)=>{this.on("modal_closed",()=>g(new Error(Pe))),this.on("connect",(b,d)=>{if(b)return g(b);c(d.params[0])})}))}async createSession(i){if(this._connected)throw new Error(ae);if(this.pending)return;this._key=await this._generateKey();const c=this._formatRequest({method:"wc_sessionRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,chainId:i&&i.chainId?i.chainId:null}]});this.handshakeId=c.id,this.handshakeTopic=se(),this._sendSessionRequest(c,"Session update rejected",{topic:this.handshakeTopic}),this._eventManager.trigger({event:"display_uri",params:[this.uri]})}approveSession(i){if(this._connected)throw new Error(ae);this.chainId=i.chainId,this.accounts=i.accounts,this.networkId=i.networkId||0,this.rpcUrl=i.rpcUrl||"";const c={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl,peerId:this.clientId,peerMeta:this.clientMeta},g={id:this.handshakeId,jsonrpc:"2.0",result:c};this._sendResponse(g),this._connected=!0,this._setStorageSession(),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})}rejectSession(i){if(this._connected)throw new Error(ae);const c=i&&i.message?i.message:hi,g=this._formatResponse({id:this.handshakeId,error:{message:c}});this._sendResponse(g),this._connected=!1,this._eventManager.trigger({event:"disconnect",params:[{message:c}]}),this._removeStorageSession()}updateSession(i){if(!this._connected)throw new Error(Ot);this.chainId=i.chainId,this.accounts=i.accounts,this.networkId=i.networkId||0,this.rpcUrl=i.rpcUrl||"";const c={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl},g=this._formatRequest({method:"wc_sessionUpdate",params:[c]});this._sendSessionRequest(g,"Session update rejected"),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]}),this._manageStorageSession()}async killSession(i){const c=i?i.message:"Session Disconnected",g={approved:!1,chainId:null,networkId:null,accounts:null},b=this._formatRequest({method:"wc_sessionUpdate",params:[g]});await this._sendRequest(b),this._handleSessionDisconnect(c)}async sendTransaction(i){if(!this._connected)throw new Error(Ot);const c=oe(i),g=this._formatRequest({method:"eth_sendTransaction",params:[c]});return await this._sendCallRequest(g)}async signTransaction(i){if(!this._connected)throw new Error(Ot);const c=oe(i),g=this._formatRequest({method:"eth_signTransaction",params:[c]});return await this._sendCallRequest(g)}async signMessage(i){if(!this._connected)throw new Error(Ot);const c=this._formatRequest({method:"eth_sign",params:i});return await this._sendCallRequest(c)}async signPersonalMessage(i){if(!this._connected)throw new Error(Ot);i=Le(i);const c=this._formatRequest({method:"personal_sign",params:i});return await this._sendCallRequest(c)}async signTypedData(i){if(!this._connected)throw new Error(Ot);const c=this._formatRequest({method:"eth_signTypedData",params:i});return await this._sendCallRequest(c)}async updateChain(i){if(!this._connected)throw new Error("Session currently disconnected");const c=this._formatRequest({method:"wallet_updateChain",params:[i]});return await this._sendCallRequest(c)}unsafeSend(i,c){return this._sendRequest(i,c),this._eventManager.trigger({event:"call_request_sent",params:[{request:i,options:c}]}),new Promise((g,b)=>{this._subscribeToResponse(i.id,(d,A)=>{if(d){b(d);return}if(!A)throw new Error(fi);g(A)})})}async sendCustomRequest(i,c){if(!this._connected)throw new Error(Ot);switch(i.method){case"eth_accounts":return this.accounts;case"eth_chainId":return Xe(this.chainId);case"eth_sendTransaction":case"eth_signTransaction":i.params&&(i.params[0]=oe(i.params[0]));break;case"personal_sign":i.params&&(i.params=Le(i.params));break}const g=this._formatRequest(i);return await this._sendCallRequest(g,c)}approveRequest(i){if(Nt(i)){const c=this._formatResponse(i);this._sendResponse(c)}else throw new Error(ui)}rejectRequest(i){if(Ut(i)){const c=this._formatResponse(i);this._sendResponse(c)}else throw new Error(ci)}transportClose(){this._transport.close()}async _sendRequest(i,c){const g=this._formatRequest(i),b=await this._encrypt(g),d=typeof(c==null?void 0:c.topic)<"u"?c.topic:this.peerId,A=JSON.stringify(b),j=typeof(c==null?void 0:c.forcePushNotification)<"u"?!c.forcePushNotification:Qr(g);this._transport.send(A,d,j)}async _sendResponse(i){const c=await this._encrypt(i),g=this.peerId,b=JSON.stringify(c),d=!0;this._transport.send(b,g,d)}async _sendSessionRequest(i,c,g){this._sendRequest(i,g),this._subscribeToSessionResponse(i.id,c)}_sendCallRequest(i,c){return this._sendRequest(i,c),this._eventManager.trigger({event:"call_request_sent",params:[{request:i,options:c}]}),this._subscribeToCallResponse(i.id)}_formatRequest(i){if(typeof i.method>"u")throw new Error(li);return{id:typeof i.id>"u"?Hr():i.id,jsonrpc:"2.0",method:i.method,params:typeof i.params>"u"?[]:i.params}}_formatResponse(i){if(typeof i.id>"u")throw new Error(di);const c={id:i.id,jsonrpc:"2.0"};if(Ut(i)){const g=Gr(i.error);return Object.assign(Object.assign(Object.assign({},c),i),{error:g})}else if(Nt(i))return Object.assign(Object.assign({},c),i);throw new Error($e)}_handleSessionDisconnect(i){const c=i||"Session Disconnected";this._connected||(this._qrcodeModal&&this._qrcodeModal.close(),Ze(je)),this._connected&&(this._connected=!1),this._handshakeId&&(this._handshakeId=0),this._handshakeTopic&&(this._handshakeTopic=""),this._peerId&&(this._peerId=""),this._eventManager.trigger({event:"disconnect",params:[{message:c}]}),this._removeStorageSession(),this.transportClose()}_handleSessionResponse(i,c){c?c.approved?(this._connected?(c.chainId&&(this.chainId=c.chainId),c.accounts&&(this.accounts=c.accounts),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]})):(this._connected=!0,c.chainId&&(this.chainId=c.chainId),c.accounts&&(this.accounts=c.accounts),c.peerId&&!this.peerId&&(this.peerId=c.peerId),c.peerMeta&&!this.peerMeta&&(this.peerMeta=c.peerMeta),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})),this._manageStorageSession()):this._handleSessionDisconnect(i):this._handleSessionDisconnect(i)}async _handleIncomingMessages(i){if(![this.clientId,this.handshakeTopic].includes(i.topic))return;let g;try{g=JSON.parse(i.payload)}catch{return}const b=await this._decrypt(g);b&&this._eventManager.trigger(b)}_subscribeToSessionRequest(){this._transport.subscribe(this.handshakeTopic)}_subscribeToResponse(i,c){this.on(`response:${i}`,c)}_subscribeToSessionResponse(i,c){this._subscribeToResponse(i,(g,b)=>{if(g){this._handleSessionResponse(g.message);return}Nt(b)?this._handleSessionResponse(c,b.result):b.error&&b.error.message?this._handleSessionResponse(b.error.message):this._handleSessionResponse(c)})}_subscribeToCallResponse(i){return new Promise((c,g)=>{this._subscribeToResponse(i,(b,d)=>{if(b){g(b);return}Nt(d)?c(d.result):d.error&&d.error.message?g(d.error):g(new Error($e))})})}_subscribeToInternalEvents(){this.on("display_uri",()=>{this._qrcodeModal&&this._qrcodeModal.open(this.uri,()=>{this._eventManager.trigger({event:"modal_closed",params:[]})},this._qrcodeModalOptions)}),this.on("connect",()=>{this._qrcodeModal&&this._qrcodeModal.close()}),this.on("call_request_sent",(i,c)=>{const{request:g}=c.params[0];if(lr()&&this._signingMethods.includes(g.method)){const b=He(je);b&&(window.location.href=b.href)}}),this.on("wc_sessionRequest",(i,c)=>{i&&this._eventManager.trigger({event:"error",params:[{code:"SESSION_REQUEST_ERROR",message:i.toString()}]}),this.handshakeId=c.id,this.peerId=c.params[0].peerId,this.peerMeta=c.params[0].peerMeta;const g=Object.assign(Object.assign({},c),{method:"session_request"});this._eventManager.trigger(g)}),this.on("wc_sessionUpdate",(i,c)=>{i&&this._handleSessionResponse(i.message),this._handleSessionResponse("Session disconnected",c.params[0])})}_initTransport(){this._transport.on("message",i=>this._handleIncomingMessages(i)),this._transport.on("open",()=>this._eventManager.trigger({event:"transport_open",params:[]})),this._transport.on("close",()=>this._eventManager.trigger({event:"transport_close",params:[]})),this._transport.on("error",()=>this._eventManager.trigger({event:"transport_error",params:["Websocket connection failed"]})),this._transport.open()}_formatUri(){const i=this.protocol,c=this.handshakeTopic,g=this.version,b=encodeURIComponent(this.bridge),d=this.key;return`${i}:${c}@${g}?bridge=${b}&key=${d}`}_parseUri(i){const c=Xr(i);if(c.protocol===this.protocol){if(!c.handshakeTopic)throw Error("Invalid or missing handshakeTopic parameter value");const g=c.handshakeTopic;if(!c.bridge)throw Error("Invalid or missing bridge url parameter value");const b=decodeURIComponent(c.bridge);if(!c.key)throw Error("Invalid or missing key parameter value");const d=c.key;return{handshakeTopic:g,bridge:b,key:d}}else throw new Error(pi)}async _generateKey(){return this._cryptoLib?await this._cryptoLib.generateKey():null}async _encrypt(i){const c=this._key;return this._cryptoLib&&c?await this._cryptoLib.encrypt(i,c):null}async _decrypt(i){const c=this._key;return this._cryptoLib&&c?await this._cryptoLib.decrypt(i,c):null}_getStorageSession(){let i=null;return this._sessionStorage&&(i=this._sessionStorage.getSession()),i}_setStorageSession(){this._sessionStorage&&this._sessionStorage.setSession(this.session)}_removeStorageSession(){this._sessionStorage&&this._sessionStorage.removeSession()}_manageStorageSession(){this._connected?this._setStorageSession():this._removeStorageSession()}_registerPushServer(i){if(!i.url||typeof i.url!="string")throw Error("Invalid or missing pushServerOpts.url parameter value");if(!i.type||typeof i.type!="string")throw Error("Invalid or missing pushServerOpts.type parameter value");if(!i.token||typeof i.token!="string")throw Error("Invalid or missing pushServerOpts.token parameter value");const c={bridge:this.bridge,topic:this.clientId,type:i.type,token:i.token,peerName:"",language:i.language||""};this.on("connect",async(g,b)=>{if(g)throw g;if(i.peerMeta){const d=b.params[0].peerMeta.name;c.peerName=d}try{if(!(await(await fetch(`${i.url}/new`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(c)})).json()).success)throw Error("Failed to register in Push Server")}catch{throw Error("Failed to register in Push Server")}})}}function Oi(a){return Ct.getBrowerCrypto().getRandomValues(new Uint8Array(a))}const ir=256,nr=ir,Ei=ir,Rt="AES-CBC",Ai=`SHA-${nr}`,he="HMAC",qi="encrypt",Ti="decrypt",Ni="sign",Ci="verify";function Fi(a){return a===Rt?{length:nr,name:Rt}:{hash:{name:Ai},name:he}}function ji(a){return a===Rt?[qi,Ti]:[Ni,Ci]}async function ve(a,i=Rt){return Ct.getSubtleCrypto().importKey("raw",a,Fi(i),!0,ji(i))}async function Ui(a,i,c){const g=Ct.getSubtleCrypto(),b=await ve(i,Rt),d=await g.encrypt({iv:a,name:Rt},b,c);return new Uint8Array(d)}async function Bi(a,i,c){const g=Ct.getSubtleCrypto(),b=await ve(i,Rt),d=await g.decrypt({iv:a,name:Rt},b,c);return new Uint8Array(d)}async function Li(a,i){const c=Ct.getSubtleCrypto(),g=await ve(a,he),b=await c.sign({length:Ei,name:he},g,i);return new Uint8Array(b)}function $i(a,i,c){return Ui(a,i,c)}function Pi(a,i,c){return Bi(a,i,c)}async function sr(a,i){return await Li(a,i)}function fe(a){return Lt(new Uint8Array(a))}function Hi(a){return qt(a).buffer}var Zi={};(function(a){const i=ce,c=le,g=ue,b=s=>s==null;function d(s){switch(s.arrayFormat){case"index":return l=>(y,v)=>{const w=y.length;return v===void 0||s.skipNull&&v===null||s.skipEmptyString&&v===""?y:v===null?[...y,[S(l,s),"[",w,"]"].join("")]:[...y,[S(l,s),"[",S(w,s),"]=",S(v,s)].join("")]};case"bracket":return l=>(y,v)=>v===void 0||s.skipNull&&v===null||s.skipEmptyString&&v===""?y:v===null?[...y,[S(l,s),"[]"].join("")]:[...y,[S(l,s),"[]=",S(v,s)].join("")];case"comma":case"separator":return l=>(y,v)=>v==null||v.length===0?y:y.length===0?[[S(l,s),"=",S(v,s)].join("")]:[[y,S(v,s)].join(s.arrayFormatSeparator)];default:return l=>(y,v)=>v===void 0||s.skipNull&&v===null||s.skipEmptyString&&v===""?y:v===null?[...y,S(l,s)]:[...y,[S(l,s),"=",S(v,s)].join("")]}}function A(s){let l;switch(s.arrayFormat){case"index":return(y,v,w)=>{if(l=/\[(\d*)\]$/.exec(y),y=y.replace(/\[\d*\]$/,""),!l){w[y]=v;return}w[y]===void 0&&(w[y]={}),w[y][l[1]]=v};case"bracket":return(y,v,w)=>{if(l=/(\[\])$/.exec(y),y=y.replace(/\[\]$/,""),!l){w[y]=v;return}if(w[y]===void 0){w[y]=[v];return}w[y]=[].concat(w[y],v)};case"comma":case"separator":return(y,v,w)=>{const _=typeof v=="string"&&v.split("").indexOf(s.arrayFormatSeparator)>-1?v.split(s.arrayFormatSeparator).map(E=>T(E,s)):v===null?v:T(v,s);w[y]=_};default:return(y,v,w)=>{if(w[y]===void 0){w[y]=v;return}w[y]=[].concat(w[y],v)}}}function j(s){if(typeof s!="string"||s.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function S(s,l){return l.encode?l.strict?i(s):encodeURIComponent(s):s}function T(s,l){return l.decode?c(s):s}function _t(s){return Array.isArray(s)?s.sort():typeof s=="object"?_t(Object.keys(s)).sort((l,y)=>Number(l)-Number(y)).map(l=>s[l]):s}function Mt(s){const l=s.indexOf("#");return l!==-1&&(s=s.slice(0,l)),s}function wt(s){let l="";const y=s.indexOf("#");return y!==-1&&(l=s.slice(y)),l}function yt(s){s=Mt(s);const l=s.indexOf("?");return l===-1?"":s.slice(l+1)}function bt(s,l){return l.parseNumbers&&!Number.isNaN(Number(s))&&typeof s=="string"&&s.trim()!==""?s=Number(s):l.parseBooleans&&s!==null&&(s.toLowerCase()==="true"||s.toLowerCase()==="false")&&(s=s.toLowerCase()==="true"),s}function St(s,l){l=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},l),j(l.arrayFormatSeparator);const y=A(l),v=Object.create(null);if(typeof s!="string"||(s=s.trim().replace(/^[?#&]/,""),!s))return v;for(const w of s.split("&")){let[I,_]=g(l.decode?w.replace(/\+/g," "):w,"=");_=_===void 0?null:["comma","separator"].includes(l.arrayFormat)?_:T(_,l),y(T(I,l),_,v)}for(const w of Object.keys(v)){const I=v[w];if(typeof I=="object"&&I!==null)for(const _ of Object.keys(I))I[_]=bt(I[_],l);else v[w]=bt(I,l)}return l.sort===!1?v:(l.sort===!0?Object.keys(v).sort():Object.keys(v).sort(l.sort)).reduce((w,I)=>{const _=v[I];return _&&typeof _=="object"&&!Array.isArray(_)?w[I]=_t(_):w[I]=_,w},Object.create(null))}a.extract=yt,a.parse=St,a.stringify=(s,l)=>{if(!s)return"";l=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},l),j(l.arrayFormatSeparator);const y=_=>l.skipNull&&b(s[_])||l.skipEmptyString&&s[_]==="",v=d(l),w={};for(const _ of Object.keys(s))y(_)||(w[_]=s[_]);const I=Object.keys(w);return l.sort!==!1&&I.sort(l.sort),I.map(_=>{const E=s[_];return E===void 0?"":E===null?S(_,l):Array.isArray(E)?E.reduce(v(_),[]).join("&"):S(_,l)+"="+S(E,l)}).filter(_=>_.length>0).join("&")},a.parseUrl=(s,l)=>{l=Object.assign({decode:!0},l);const[y,v]=g(s,"#");return Object.assign({url:y.split("?")[0]||"",query:St(yt(s),l)},l&&l.parseFragmentIdentifier&&v?{fragmentIdentifier:T(v,l)}:{})},a.stringifyUrl=(s,l)=>{l=Object.assign({encode:!0,strict:!0},l);const y=Mt(s.url).split("?")[0]||"",v=a.extract(s.url),w=a.parse(v,{sort:!1}),I=Object.assign(w,s.query);let _=a.stringify(I,l);_&&(_=`?${_}`);let E=wt(s.url);return s.fragmentIdentifier&&(E=`#${S(s.fragmentIdentifier,l)}`),`${y}${_}${E}`}})(Zi);async function or(a){const i=(a||256)/8,c=Oi(i);return Hi(Lt(c))}async function ar(a,i){const c=At(a.data),g=At(a.iv),b=At(a.hmac),d=Et(b,!1),A=Ve(c,g),j=await sr(i,A),S=Et(j,!1);return It(d)===It(S)}async function Ji(a,i,c){const g=qt(fe(i)),b=c||await or(128),d=qt(fe(b)),A=Et(d,!1),j=JSON.stringify(a),S=Er(j),T=await $i(d,g,S),_t=Et(T,!1),Mt=Ve(T,d),wt=await sr(g,Mt),yt=Et(wt,!1);return{data:_t,hmac:yt,iv:A}}async function Di(a,i){const c=qt(fe(i));if(!c)throw new Error("Missing key: required for decryption");if(!await ar(a,c))return null;const b=At(a.data),d=At(a.iv),A=await Pi(d,c,b),j=kr(A);let S;try{S=JSON.parse(j)}catch{return null}return S}const Ki=Object.freeze(Object.defineProperty({__proto__:null,decrypt:Di,encrypt:Ji,generateKey:or,verifyHmac:ar},Symbol.toStringTag,{value:"Module"}));class Yi extends ki{constructor(i,c){super({cryptoLib:Ki,connectorOpts:i,pushServerOpts:c})}}export{Yi as default};
